"use strict";(()=>{var e={};e.id=157,e.ids=[157],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},83965:(e,t,r)=>{let a,i,n,s;r.r(t),r.d(t,{originalPathname:()=>a8,patchFetch:()=>a3,requestAsyncStorage:()=>a4,routeModule:()=>a2,serverHooks:()=>a5,staticGenerationAsyncStorage:()=>a6});var o,d,c,l,u,p,h={};r.r(h),r.d(h,{GET:()=>a1,POST:()=>a1});var f=r(49303),m=r(88716),y=r(60670);(function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(o||(o={})),(d||(d={})).mergeShapes=(e,t)=>({...e,...t});let g=o.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_=e=>{switch(typeof e){case"undefined":return g.undefined;case"string":return g.string;case"number":return isNaN(e)?g.nan:g.number;case"boolean":return g.boolean;case"function":return g.function;case"bigint":return g.bigint;case"symbol":return g.symbol;case"object":if(Array.isArray(e))return g.array;if(null===e)return g.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return g.promise;if("undefined"!=typeof Map&&e instanceof Map)return g.map;if("undefined"!=typeof Set&&e instanceof Set)return g.set;if("undefined"!=typeof Date&&e instanceof Date)return g.date;return g.object;default:return g.unknown}},v=o.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class w extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(a);else if("invalid_return_type"===i.code)a(i.returnTypeError);else if("invalid_arguments"===i.code)a(i.argumentsError);else if(0===i.path.length)r._errors.push(t(i));else{let e=r,a=0;for(;a<i.path.length;){let r=i.path[a];a===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof w))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,o.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}w.create=e=>new w(e);let E=(e,t)=>{let r;switch(e.code){case v.invalid_type:r=e.received===g.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case v.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,o.jsonStringifyReplacer)}`;break;case v.unrecognized_keys:r=`Unrecognized key(s) in object: ${o.joinValues(e.keys,", ")}`;break;case v.invalid_union:r="Invalid input";break;case v.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${o.joinValues(e.options)}`;break;case v.invalid_enum_value:r=`Invalid enum value. Expected ${o.joinValues(e.options)}, received '${e.received}'`;break;case v.invalid_arguments:r="Invalid function arguments";break;case v.invalid_return_type:r="Invalid function return type";break;case v.invalid_date:r="Invalid date";break;case v.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:o.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case v.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case v.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case v.custom:r="Invalid input";break;case v.invalid_intersection_types:r="Intersection results could not be merged";break;case v.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case v.not_finite:r="Number must be finite";break;default:r=t.defaultError,o.assertNever(e)}return{message:r}},b=E;function k(){return b}let x=e=>{let{data:t,path:r,errorMaps:a,issueData:i}=e,n=[...r,...i.path||[]],s={...i,path:n};if(void 0!==i.message)return{...i,path:n,message:i.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(s,{data:t,defaultError:o}).message;return{...i,path:n,message:o}};function S(e,t){let r=k(),a=x({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===E?void 0:E].filter(e=>!!e)});e.common.issues.push(a)}class T{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return A;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return T.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:i}=a;if("aborted"===t.status||"aborted"===i.status)return A;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==i.value||a.alwaysSet)&&(r[t.value]=i.value)}return{status:e.value,value:r}}}let A=Object.freeze({status:"aborted"}),O=e=>({status:"dirty",value:e}),R=e=>({status:"valid",value:e}),C=e=>"aborted"===e.status,P=e=>"dirty"===e.status,I=e=>"valid"===e.status,U=e=>"undefined"!=typeof Promise&&e instanceof Promise;function K(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function N(e,t,r,a,i){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!i)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(c||(c={}));class D{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let j=(e,t)=>{if(I(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new w(e.common.issues);return this._error=t,this._error}}};function Z(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:i}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:i}:{errorMap:(t,i)=>{var n,s;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:i.defaultError}:void 0===i.data?{message:null!==(n=null!=o?o:a)&&void 0!==n?n:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:i.defaultError}},description:i}}class M{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return _(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:_(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new T,ctx:{common:e.parent.common,data:e.data,parsedType:_(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(U(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_(e)},i=this._parseSync({data:e,path:a.path,parent:a});return j(a,i)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_(e)},a=this._parse({data:e,path:r.path,parent:r});return j(r,await (U(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let i=e(t),n=()=>a.addIssue({code:v.custom,...r(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(e=>!!e||(n(),!1)):!!i||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new eR({schema:this,typeName:p.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return eC.create(this,this._def)}nullable(){return eP.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ep.create(this,this._def)}promise(){return eO.create(this,this._def)}or(e){return ef.create([this,e],this._def)}and(e){return eg.create(this,e,this._def)}transform(e){return new eR({...Z(this._def),schema:this,typeName:p.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new eI({...Z(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:p.ZodDefault})}brand(){return new eD({typeName:p.ZodBranded,type:this,...Z(this._def)})}catch(e){return new eU({...Z(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:p.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ej.create(this,e)}readonly(){return eZ.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let H=/^c[^\s-]{8,}$/i,$=/^[0-9a-z]+$/,W=/^[0-9A-HJKMNP-TV-Z]{26}$/,L=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,B=/^[a-z0-9_-]{21}$/i,J=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,z=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,G=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,V=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,q="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Y=RegExp(`^${q}$`);function X(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function Q(e){let t=`${q}T${X(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class ee extends M{_parse(e){var t,r;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==g.string){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.string,received:t.parsedType}),A}let n=new T;for(let s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(S(i=this._getOrReturnCtx(e,i),{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if("max"===s.kind)e.data.length>s.value&&(S(i=this._getOrReturnCtx(e,i),{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if("length"===s.kind){let t=e.data.length>s.value,r=e.data.length<s.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?S(i,{code:v.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):r&&S(i,{code:v.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if("email"===s.kind)z.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"email",code:v.invalid_string,message:s.message}),n.dirty());else if("emoji"===s.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:v.invalid_string,message:s.message}),n.dirty());else if("uuid"===s.kind)L.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:v.invalid_string,message:s.message}),n.dirty());else if("nanoid"===s.kind)B.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:v.invalid_string,message:s.message}),n.dirty());else if("cuid"===s.kind)H.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:v.invalid_string,message:s.message}),n.dirty());else if("cuid2"===s.kind)$.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:v.invalid_string,message:s.message}),n.dirty());else if("ulid"===s.kind)W.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:v.invalid_string,message:s.message}),n.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(t){S(i=this._getOrReturnCtx(e,i),{validation:"url",code:v.invalid_string,message:s.message}),n.dirty()}else"regex"===s.kind?(s.regex.lastIndex=0,s.regex.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"regex",code:v.invalid_string,message:s.message}),n.dirty())):"trim"===s.kind?e.data=e.data.trim():"includes"===s.kind?e.data.includes(s.value,s.position)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):"toLowerCase"===s.kind?e.data=e.data.toLowerCase():"toUpperCase"===s.kind?e.data=e.data.toUpperCase():"startsWith"===s.kind?e.data.startsWith(s.value)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):"endsWith"===s.kind?e.data.endsWith(s.value)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):"datetime"===s.kind?Q(s).test(e.data)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:"datetime",message:s.message}),n.dirty()):"date"===s.kind?Y.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:"date",message:s.message}),n.dirty()):"time"===s.kind?RegExp(`^${X(s)}$`).test(e.data)||(S(i=this._getOrReturnCtx(e,i),{code:v.invalid_string,validation:"time",message:s.message}),n.dirty()):"duration"===s.kind?J.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"duration",code:v.invalid_string,message:s.message}),n.dirty()):"ip"===s.kind?(t=e.data,("v4"===(r=s.version)||!r)&&F.test(t)||("v6"===r||!r)&&G.test(t)||(S(i=this._getOrReturnCtx(e,i),{validation:"ip",code:v.invalid_string,message:s.message}),n.dirty())):"base64"===s.kind?V.test(e.data)||(S(i=this._getOrReturnCtx(e,i),{validation:"base64",code:v.invalid_string,message:s.message}),n.dirty()):o.assertNever(s);return{status:n.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:v.invalid_string,...c.errToObj(r)})}_addCheck(e){return new ee({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...c.errToObj(e)})}url(e){return this._addCheck({kind:"url",...c.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...c.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...c.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...c.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...c.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...c.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...c.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...c.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...c.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...c.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...c.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...c.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...c.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...c.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...c.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...c.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...c.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...c.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...c.errToObj(t)})}nonempty(e){return this.min(1,c.errToObj(e))}trim(){return new ee({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ee({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ee({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}ee.create=e=>{var t;return new ee({checks:[],typeName:p.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Z(e)})};class et extends M{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==g.number){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.number,received:t.parsedType}),A}let r=new T;for(let a of this._def.checks)"int"===a.kind?o.isInteger(e.data)||(S(t=this._getOrReturnCtx(e,t),{code:v.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,i=r>a?r:a;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}(e.data,a.value)&&(S(t=this._getOrReturnCtx(e,t),{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(S(t=this._getOrReturnCtx(e,t),{code:v.not_finite,message:a.message}),r.dirty()):o.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,a){return new et({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(a)}]})}_addCheck(e){return new et({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:c.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:c.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:c.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:c.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&o.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}et.create=e=>new et({checks:[],typeName:p.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Z(e)});class er extends M{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==g.bigint){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.bigint,received:t.parsedType}),A}let r=new T;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(S(t=this._getOrReturnCtx(e,t),{code:v.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):o.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,c.toString(t))}gt(e,t){return this.setLimit("min",e,!1,c.toString(t))}lte(e,t){return this.setLimit("max",e,!0,c.toString(t))}lt(e,t){return this.setLimit("max",e,!1,c.toString(t))}setLimit(e,t,r,a){return new er({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:c.toString(a)}]})}_addCheck(e){return new er({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:c.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:c.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:c.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:c.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:c.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}er.create=e=>{var t;return new er({checks:[],typeName:p.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Z(e)})};class ea extends M{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==g.boolean){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.boolean,received:t.parsedType}),A}return R(e.data)}}ea.create=e=>new ea({typeName:p.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Z(e)});class ei extends M{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==g.date){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.date,received:t.parsedType}),A}if(isNaN(e.data.getTime()))return S(this._getOrReturnCtx(e),{code:v.invalid_date}),A;let r=new T;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(S(t=this._getOrReturnCtx(e,t),{code:v.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):o.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ei({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:c.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:c.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}ei.create=e=>new ei({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:p.ZodDate,...Z(e)});class en extends M{_parse(e){if(this._getType(e)!==g.symbol){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.symbol,received:t.parsedType}),A}return R(e.data)}}en.create=e=>new en({typeName:p.ZodSymbol,...Z(e)});class es extends M{_parse(e){if(this._getType(e)!==g.undefined){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.undefined,received:t.parsedType}),A}return R(e.data)}}es.create=e=>new es({typeName:p.ZodUndefined,...Z(e)});class eo extends M{_parse(e){if(this._getType(e)!==g.null){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.null,received:t.parsedType}),A}return R(e.data)}}eo.create=e=>new eo({typeName:p.ZodNull,...Z(e)});class ed extends M{constructor(){super(...arguments),this._any=!0}_parse(e){return R(e.data)}}ed.create=e=>new ed({typeName:p.ZodAny,...Z(e)});class ec extends M{constructor(){super(...arguments),this._unknown=!0}_parse(e){return R(e.data)}}ec.create=e=>new ec({typeName:p.ZodUnknown,...Z(e)});class el extends M{_parse(e){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.never,received:t.parsedType}),A}}el.create=e=>new el({typeName:p.ZodNever,...Z(e)});class eu extends M{_parse(e){if(this._getType(e)!==g.undefined){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.void,received:t.parsedType}),A}return R(e.data)}}eu.create=e=>new eu({typeName:p.ZodVoid,...Z(e)});class ep extends M{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==g.array)return S(t,{code:v.invalid_type,expected:g.array,received:t.parsedType}),A;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,i=t.data.length<a.exactLength.value;(e||i)&&(S(t,{code:e?v.too_big:v.too_small,minimum:i?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(S(t,{code:v.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(S(t,{code:v.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new D(t,e,t.path,r)))).then(e=>T.mergeArray(r,e));let i=[...t.data].map((e,r)=>a.type._parseSync(new D(t,e,t.path,r)));return T.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new ep({...this._def,minLength:{value:e,message:c.toString(t)}})}max(e,t){return new ep({...this._def,maxLength:{value:e,message:c.toString(t)}})}length(e,t){return new ep({...this._def,exactLength:{value:e,message:c.toString(t)}})}nonempty(e){return this.min(1,e)}}ep.create=(e,t)=>new ep({type:e,minLength:null,maxLength:null,exactLength:null,typeName:p.ZodArray,...Z(t)});class eh extends M{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=o.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==g.object){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.object,received:t.parsedType}),A}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),n=[];if(!(this._def.catchall instanceof el&&"strip"===this._def.unknownKeys))for(let e in r.data)i.includes(e)||n.push(e);let s=[];for(let e of i){let t=a[e],i=r.data[e];s.push({key:{status:"valid",value:e},value:t._parse(new D(r,i,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof el){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)s.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(S(r,{code:v.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];s.push({key:{status:"valid",value:t},value:e._parse(new D(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of s){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>T.mergeObjectSync(t,e)):T.mergeObjectSync(t,s)}get shape(){return this._def.shape()}strict(e){return c.errToObj,new eh({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,i,n,s;let o=null!==(n=null===(i=(a=this._def).errorMap)||void 0===i?void 0:i.call(a,t,r).message)&&void 0!==n?n:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=c.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new eh({...this._def,unknownKeys:"strip"})}passthrough(){return new eh({...this._def,unknownKeys:"passthrough"})}extend(e){return new eh({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new eh({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:p.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new eh({...this._def,catchall:e})}pick(e){let t={};return o.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new eh({...this._def,shape:()=>t})}omit(e){let t={};return o.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new eh({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof eh){let r={};for(let a in t.shape){let i=t.shape[a];r[a]=eC.create(e(i))}return new eh({...t._def,shape:()=>r})}return t instanceof ep?new ep({...t._def,type:e(t.element)}):t instanceof eC?eC.create(e(t.unwrap())):t instanceof eP?eP.create(e(t.unwrap())):t instanceof e_?e_.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return o.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new eh({...this._def,shape:()=>t})}required(e){let t={};return o.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof eC;)e=e._def.innerType;t[r]=e}}),new eh({...this._def,shape:()=>t})}keyof(){return eS(o.objectKeys(this.shape))}}eh.create=(e,t)=>new eh({shape:()=>e,unknownKeys:"strip",catchall:el.create(),typeName:p.ZodObject,...Z(t)}),eh.strictCreate=(e,t)=>new eh({shape:()=>e,unknownKeys:"strict",catchall:el.create(),typeName:p.ZodObject,...Z(t)}),eh.lazycreate=(e,t)=>new eh({shape:e,unknownKeys:"strip",catchall:el.create(),typeName:p.ZodObject,...Z(t)});class ef extends M{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new w(e.ctx.common.issues));return S(t,{code:v.invalid_union,unionErrors:r}),A});{let e;let a=[];for(let i of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=i._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let i=a.map(e=>new w(e));return S(t,{code:v.invalid_union,unionErrors:i}),A}}get options(){return this._def.options}}ef.create=(e,t)=>new ef({options:e,typeName:p.ZodUnion,...Z(t)});let em=e=>{if(e instanceof ek)return em(e.schema);if(e instanceof eR)return em(e.innerType());if(e instanceof ex)return[e.value];if(e instanceof eT)return e.options;if(e instanceof eA)return o.objectValues(e.enum);if(e instanceof eI)return em(e._def.innerType);if(e instanceof es)return[void 0];else if(e instanceof eo)return[null];else if(e instanceof eC)return[void 0,...em(e.unwrap())];else if(e instanceof eP)return[null,...em(e.unwrap())];else if(e instanceof eD)return em(e.unwrap());else if(e instanceof eZ)return em(e.unwrap());else if(e instanceof eU)return em(e._def.innerType);else return[]};class ey extends M{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.object)return S(t,{code:v.invalid_type,expected:g.object,received:t.parsedType}),A;let r=this.discriminator,a=t.data[r],i=this.optionsMap.get(a);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(S(t,{code:v.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=em(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of t){if(a.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);a.set(i,r)}}return new ey({typeName:p.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...Z(r)})}}class eg extends M{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(C(e)||C(a))return A;let i=function e(t,r){let a=_(t),i=_(r);if(t===r)return{valid:!0,data:t};if(a===g.object&&i===g.object){let a=o.objectKeys(r),i=o.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of i){let i=e(t[a],r[a]);if(!i.valid)return{valid:!1};n[a]=i.data}return{valid:!0,data:n}}if(a===g.array&&i===g.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let i=0;i<t.length;i++){let n=e(t[i],r[i]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}return a===g.date&&i===g.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return i.valid?((P(e)||P(a))&&t.dirty(),{status:t.value,value:i.data}):(S(r,{code:v.invalid_intersection_types}),A)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}eg.create=(e,t,r)=>new eg({left:e,right:t,typeName:p.ZodIntersection,...Z(r)});class e_ extends M{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.array)return S(r,{code:v.invalid_type,expected:g.array,received:r.parsedType}),A;if(r.data.length<this._def.items.length)return S(r,{code:v.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;!this._def.rest&&r.data.length>this._def.items.length&&(S(r,{code:v.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new D(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>T.mergeArray(t,e)):T.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new e_({...this._def,rest:e})}}e_.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new e_({items:e,typeName:p.ZodTuple,rest:null,...Z(t)})};class ev extends M{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.object)return S(r,{code:v.invalid_type,expected:g.object,received:r.parsedType}),A;let a=[],i=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:i._parse(new D(r,e,r.path,e)),value:n._parse(new D(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?T.mergeObjectAsync(t,a):T.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ev(t instanceof M?{keyType:e,valueType:t,typeName:p.ZodRecord,...Z(r)}:{keyType:ee.create(),valueType:e,typeName:p.ZodRecord,...Z(t)})}}class ew extends M{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.map)return S(r,{code:v.invalid_type,expected:g.map,received:r.parsedType}),A;let a=this._def.keyType,i=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new D(r,e,r.path,[n,"key"])),value:i._parse(new D(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,i=await r.value;if("aborted"===a.status||"aborted"===i.status)return A;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,i=r.value;if("aborted"===a.status||"aborted"===i.status)return A;("dirty"===a.status||"dirty"===i.status)&&t.dirty(),e.set(a.value,i.value)}return{status:t.value,value:e}}}}ew.create=(e,t,r)=>new ew({valueType:t,keyType:e,typeName:p.ZodMap,...Z(r)});class eE extends M{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==g.set)return S(r,{code:v.invalid_type,expected:g.set,received:r.parsedType}),A;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(S(r,{code:v.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(S(r,{code:v.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let i=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return A;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let s=[...r.data.values()].map((e,t)=>i._parse(new D(r,e,r.path,t)));return r.common.async?Promise.all(s).then(e=>n(e)):n(s)}min(e,t){return new eE({...this._def,minSize:{value:e,message:c.toString(t)}})}max(e,t){return new eE({...this._def,maxSize:{value:e,message:c.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}eE.create=(e,t)=>new eE({valueType:e,minSize:null,maxSize:null,typeName:p.ZodSet,...Z(t)});class eb extends M{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==g.function)return S(t,{code:v.invalid_type,expected:g.function,received:t.parsedType}),A;function r(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,k(),E].filter(e=>!!e),issueData:{code:v.invalid_arguments,argumentsError:r}})}function a(e,r){return x({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,k(),E].filter(e=>!!e),issueData:{code:v.invalid_return_type,returnTypeError:r}})}let i={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof eO){let e=this;return R(async function(...t){let s=new w([]),o=await e._def.args.parseAsync(t,i).catch(e=>{throw s.addIssue(r(t,e)),s}),d=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(d,i).catch(e=>{throw s.addIssue(a(d,e)),s})})}{let e=this;return R(function(...t){let s=e._def.args.safeParse(t,i);if(!s.success)throw new w([r(t,s.error)]);let o=Reflect.apply(n,this,s.data),d=e._def.returns.safeParse(o,i);if(!d.success)throw new w([a(o,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new eb({...this._def,args:e_.create(e).rest(ec.create())})}returns(e){return new eb({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new eb({args:e||e_.create([]).rest(ec.create()),returns:t||ec.create(),typeName:p.ZodFunction,...Z(r)})}}class ek extends M{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}ek.create=(e,t)=>new ek({getter:e,typeName:p.ZodLazy,...Z(t)});class ex extends M{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return S(t,{received:t.data,code:v.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:e.data}}get value(){return this._def.value}}function eS(e,t){return new eT({values:e,typeName:p.ZodEnum,...Z(t)})}ex.create=(e,t)=>new ex({value:e,typeName:p.ZodLiteral,...Z(t)});class eT extends M{constructor(){super(...arguments),l.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return S(t,{expected:o.joinValues(r),received:t.parsedType,code:v.invalid_type}),A}if(K(this,l,"f")||N(this,l,new Set(this._def.values),"f"),!K(this,l,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return S(t,{received:t.data,code:v.invalid_enum_value,options:r}),A}return R(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return eT.create(e,{...this._def,...t})}exclude(e,t=this._def){return eT.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}l=new WeakMap,eT.create=eS;class eA extends M{constructor(){super(...arguments),u.set(this,void 0)}_parse(e){let t=o.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==g.string&&r.parsedType!==g.number){let e=o.objectValues(t);return S(r,{expected:o.joinValues(e),received:r.parsedType,code:v.invalid_type}),A}if(K(this,u,"f")||N(this,u,new Set(o.getValidEnumValues(this._def.values)),"f"),!K(this,u,"f").has(e.data)){let e=o.objectValues(t);return S(r,{received:r.data,code:v.invalid_enum_value,options:e}),A}return R(e.data)}get enum(){return this._def.values}}u=new WeakMap,eA.create=(e,t)=>new eA({values:e,typeName:p.ZodNativeEnum,...Z(t)});class eO extends M{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==g.promise&&!1===t.common.async?(S(t,{code:v.invalid_type,expected:g.promise,received:t.parsedType}),A):R((t.parsedType===g.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}eO.create=(e,t)=>new eO({type:e,typeName:p.ZodPromise,...Z(t)});class eR extends M{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===p.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:e=>{S(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===a.type){let e=a.transform(r.data,i);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return A;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?A:"dirty"===a.status||"dirty"===t.value?O(a.value):a});{if("aborted"===t.value)return A;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?A:"dirty"===a.status||"dirty"===t.value?O(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,i);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?A:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?A:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>I(e)?Promise.resolve(a.transform(e.value,i)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!I(e))return e;let n=a.transform(e.value,i);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}o.assertNever(a)}}eR.create=(e,t,r)=>new eR({schema:e,typeName:p.ZodEffects,effect:t,...Z(r)}),eR.createWithPreprocess=(e,t,r)=>new eR({schema:t,effect:{type:"preprocess",transform:e},typeName:p.ZodEffects,...Z(r)});class eC extends M{_parse(e){return this._getType(e)===g.undefined?R(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eC.create=(e,t)=>new eC({innerType:e,typeName:p.ZodOptional,...Z(t)});class eP extends M{_parse(e){return this._getType(e)===g.null?R(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}eP.create=(e,t)=>new eP({innerType:e,typeName:p.ZodNullable,...Z(t)});class eI extends M{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===g.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}eI.create=(e,t)=>new eI({innerType:e,typeName:p.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Z(t)});class eU extends M{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return U(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new w(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new w(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}eU.create=(e,t)=>new eU({innerType:e,typeName:p.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Z(t)});class eK extends M{_parse(e){if(this._getType(e)!==g.nan){let t=this._getOrReturnCtx(e);return S(t,{code:v.invalid_type,expected:g.nan,received:t.parsedType}),A}return{status:"valid",value:e.data}}}eK.create=e=>new eK({typeName:p.ZodNaN,...Z(e)});let eN=Symbol("zod_brand");class eD extends M{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ej extends M{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?A:"dirty"===e.status?(t.dirty(),O(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?A:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ej({in:e,out:t,typeName:p.ZodPipeline})}}class eZ extends M{_parse(e){let t=this._def.innerType._parse(e),r=e=>(I(e)&&(e.value=Object.freeze(e.value)),e);return U(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function eM(e,t={},r){return e?ed.create().superRefine((a,i)=>{var n,s;if(!e(a)){let e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(s=null!==(n=e.fatal)&&void 0!==n?n:r)||void 0===s||s;i.addIssue({code:"custom",..."string"==typeof e?{message:e}:e,fatal:o})}}):ed.create()}eZ.create=(e,t)=>new eZ({innerType:e,typeName:p.ZodReadonly,...Z(t)});let eH={object:eh.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(p||(p={}));let e$=ee.create,eW=et.create,eL=eK.create,eB=er.create,eJ=ea.create,ez=ei.create,eF=en.create,eG=es.create,eV=eo.create,eq=ed.create,eY=ec.create,eX=el.create,eQ=eu.create,e0=ep.create,e1=eh.create,e2=eh.strictCreate,e4=ef.create,e6=ey.create,e5=eg.create,e8=e_.create,e3=ev.create,e9=ew.create,e7=eE.create,te=eb.create,tt=ek.create,tr=ex.create,ta=eT.create,ti=eA.create,tn=eO.create,ts=eR.create,to=eC.create,td=eP.create,tc=eR.createWithPreprocess,tl=ej.create;var tu=Object.freeze({__proto__:null,defaultErrorMap:E,setErrorMap:function(e){b=e},getErrorMap:k,makeIssue:x,EMPTY_PATH:[],addIssueToContext:S,ParseStatus:T,INVALID:A,DIRTY:O,OK:R,isAborted:C,isDirty:P,isValid:I,isAsync:U,get util(){return o},get objectUtil(){return d},ZodParsedType:g,getParsedType:_,ZodType:M,datetimeRegex:Q,ZodString:ee,ZodNumber:et,ZodBigInt:er,ZodBoolean:ea,ZodDate:ei,ZodSymbol:en,ZodUndefined:es,ZodNull:eo,ZodAny:ed,ZodUnknown:ec,ZodNever:el,ZodVoid:eu,ZodArray:ep,ZodObject:eh,ZodUnion:ef,ZodDiscriminatedUnion:ey,ZodIntersection:eg,ZodTuple:e_,ZodRecord:ev,ZodMap:ew,ZodSet:eE,ZodFunction:eb,ZodLazy:ek,ZodLiteral:ex,ZodEnum:eT,ZodNativeEnum:eA,ZodPromise:eO,ZodEffects:eR,ZodTransformer:eR,ZodOptional:eC,ZodNullable:eP,ZodDefault:eI,ZodCatch:eU,ZodNaN:eK,BRAND:eN,ZodBranded:eD,ZodPipeline:ej,ZodReadonly:eZ,custom:eM,Schema:M,ZodSchema:M,late:eH,get ZodFirstPartyTypeKind(){return p},coerce:{string:e=>ee.create({...e,coerce:!0}),number:e=>et.create({...e,coerce:!0}),boolean:e=>ea.create({...e,coerce:!0}),bigint:e=>er.create({...e,coerce:!0}),date:e=>ei.create({...e,coerce:!0})},any:eq,array:e0,bigint:eB,boolean:eJ,date:ez,discriminatedUnion:e6,effect:ts,enum:ta,function:te,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>eM(t=>t instanceof e,t),intersection:e5,lazy:tt,literal:tr,map:e9,nan:eL,nativeEnum:ti,never:eX,null:eV,nullable:td,number:eW,object:e1,oboolean:()=>eJ().optional(),onumber:()=>eW().optional(),optional:to,ostring:()=>e$().optional(),pipeline:tl,preprocess:tc,promise:tn,record:e3,set:e7,strictObject:e2,string:e$,symbol:eF,transformer:ts,tuple:e8,undefined:eG,union:e4,unknown:eY,void:eQ,NEVER:A,ZodIssueCode:v,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:w});function tp(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let th={BAD_REQUEST:400,FILE_TOO_LARGE:400,MIME_TYPE_NOT_ALLOWED:400,UNAUTHORIZED:401,UPLOAD_NOT_ALLOWED:403,DELETE_NOT_ALLOWED:403,CREATE_CONTEXT_ERROR:500,SERVER_ERROR:500};class tf extends Error{formattedMessage(){return`${this.message}${this.details?`
    Details: ${JSON.stringify(this.details)}`:""}${this.cause?`
    Caused by: ${this.cause.message}`:""}`}formattedJson(){return{message:"SERVER_ERROR"===this.code?"Internal server error":this.message,code:this.code,details:this.details}}constructor(e){super(e.message),tp(this,"cause",void 0),tp(this,"code",void 0),tp(this,"level",void 0),tp(this,"details",void 0),this.name="EdgeStoreError",this.code=e.code,this.cause=e.cause,this.level=th[e.code]>=500?"error":"warn",this.details="details"in e?e.details:void 0}}let tm=(e,t)=>{let r={...e,...t};return ty({type:r.type},r)};function ty(e,t){let r={type:e.type,input:tu.never(),path:[],metadata:()=>({}),...t};return{$config:{ctx:void 0},_def:r,input:e=>tm(r,{input:e}),path:e=>tm(r,{path:e(function(){let e=(t,r)=>new Proxy(()=>t,{get:(r,a)=>e(`${t}.${String(a)}`)});return new Proxy(()=>"",{get:(t,r)=>e(String(r))})}())}),metadata:e=>tm(r,{metadata:e}),accessControl:e=>tm(r,{accessControl:e}),beforeUpload:e=>tm(r,{beforeUpload:e}),beforeDelete:e=>tm(r,{beforeDelete:e})}}class tg{context(){return new tg}create(){return{imageBucket:e=>t_("IMAGE",e),fileBucket:e=>t_("FILE",e),router:function(e){return{$config:{ctx:void 0},buckets:e}}}}}function t_(e,t){return ty({type:e},{bucketConfig:t})}let tv=new tg,tw=["debug","info","warn","error","none"];class tE{shouldLog(e){return tw.indexOf(e)>=tw.indexOf(this.logLevel)}debug(e,...t){this.shouldLog("debug")&&console.debug("[EdgeStoreDebug]",e,...t)}info(e,...t){this.shouldLog("info")&&console.info("[EdgeStoreInfo]",e,...t)}warn(e,...t){this.shouldLog("warn")&&console.warn("[EdgeStoreWarn]",e,...t)}error(e,...t){this.shouldLog("error")&&console.error("[EdgeStoreError]",e,...t)}constructor(e){(function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r})(this,"logLevel",void 0),this.logLevel=e??"error"}}function tb(e,t){return RegExp(`${t}/?(\\?.*)?$`).test(e)}let tk=`Missing EDGE_STORE_ACCESS_KEY or EDGE_STORE_SECRET_KEY. 
This can happen if you are trying to import something related to the backend of Edge Store in a client component.`;class tx extends Error{constructor(e=tk){super(e),this.name="EdgeStoreCredentialsError"}}let tS=process.env.EDGE_STORE_API_ENDPOINT??"https://api.edgestore.dev";async function tT(e){let{body:t,accessKey:r,secretKey:a,path:i}=e,n=await fetch(`${tS}${i}`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:`Basic ${Buffer.from(`${r}:${a}`).toString("base64")}`}});if(!n.ok)throw Error(`Failed to make request to ${i}: ${await n.text()}`);return await n.json()}let tA={async getToken(e){let t=Object.entries(e.router.buckets).reduce((e,[t,r])=>(e[t]={path:r._def.path.map(e=>{let t=Object.entries(e);if(void 0===t[0])throw new tf({message:`Empty path param found in: ${JSON.stringify(r._def.path)}`,code:"SERVER_ERROR"});let[a,i]=t[0];return{key:a,value:i()}}),accessControl:r._def.accessControl},e),{}),{token:r}=await tT({body:{ctx:e.ctx,buckets:t},accessKey:e.accessKey,secretKey:e.secretKey,path:"/get-token"});return r},getFile:async({accessKey:e,secretKey:t,url:r})=>await tT({path:"/get-file",accessKey:e,secretKey:t,body:{url:r}}),async requestUpload({accessKey:e,secretKey:t,bucketName:r,bucketType:a,fileInfo:i,multipart:n}){let s=await tT({path:"/request-upload",accessKey:e,secretKey:t,body:{multipart:n,bucketName:r,bucketType:a,isPublic:i.isPublic,path:i.path,extension:i.extension,size:i.size,mimeType:i.type,metadata:i.metadata,fileName:i.fileName,replaceTargetUrl:i.replaceTargetUrl,isTemporary:i.temporary}});return{multipart:s.multipart,signedUrl:s.signedUrl,accessUrl:s.url,path:s.path,thumbnailUrl:s.thumbnailUrl}},requestUploadParts:async({accessKey:e,secretKey:t,key:r,multipart:a})=>({multipart:(await tT({path:"/request-upload-parts",accessKey:e,secretKey:t,body:{multipart:a,key:r}})).multipart}),completeMultipartUpload:async({accessKey:e,secretKey:t,uploadId:r,key:a,parts:i})=>await tT({path:"/complete-multipart-upload",accessKey:e,secretKey:t,body:{uploadId:r,key:a,parts:i}}),confirmUpload:async({accessKey:e,secretKey:t,url:r})=>await tT({path:"/confirm-upload",accessKey:e,secretKey:t,body:{url:r}}),deleteFile:async({accessKey:e,secretKey:t,url:r})=>await tT({path:"/delete-file",accessKey:e,secretKey:t,body:{url:r}}),listFiles:async({accessKey:e,secretKey:t,bucketName:r,filter:a,pagination:i})=>await tT({path:"/list-files",accessKey:e,secretKey:t,body:{bucketName:r,filter:a,pagination:i}})};var tO=r(6113),tR=r.n(tO);let tC=(e,t,r,a,i)=>{let n=parseInt(e.substr(3),10)>>3||20,s=(0,tO.createHmac)(e,r.byteLength?r:new Uint8Array(n)).update(t).digest(),o=Math.ceil(i/n),d=new Uint8Array(n*o+a.byteLength+1),c=0,l=0;for(let t=1;t<=o;t++)d.set(a,l),d[l+a.byteLength]=t,d.set((0,tO.createHmac)(e,s).update(d.subarray(c,l+a.byteLength+1)).digest(),l),c=l,l+=n;return d.slice(0,i)};"function"!=typeof tO.hkdf||process.versions.electron||(i=async(...e)=>new Promise((t,r)=>{tO.hkdf(...e,(e,a)=>{e?r(e):t(new Uint8Array(a))})}));let tP=async(e,t,r,a,n)=>(i||tC)(e,t,r,a,n);function tI(e,t){if("string"==typeof e)return new TextEncoder().encode(e);if(!(e instanceof Uint8Array))throw TypeError(`"${t}"" must be an instance of Uint8Array or a string`);return e}async function tU(e,t,r,a,i){return tP(function(e){switch(e){case"sha256":case"sha384":case"sha512":case"sha1":return e;default:throw TypeError('unsupported "digest" value')}}(e),function(e){let t=tI(e,"ikm");if(!t.byteLength)throw TypeError('"ikm" must be at least one byte in length');return t}(t),tI(r,"salt"),function(e){let t=tI(e,"info");if(t.byteLength>1024)throw TypeError('"info" must not contain more than 1024 bytes');return t}(a),function(e,t){if("number"!=typeof e||!Number.isInteger(e)||e<1)throw TypeError('"keylen" must be a positive integer');if(e>255*(parseInt(t.substr(3),10)>>3||20))throw TypeError('"keylen" too large');return e}(i,e))}var tK=r(43183),tN=r(14300);let tD=(e,t)=>(0,tO.createHash)(e).update(t).digest(),tj=new TextEncoder,tZ=new TextDecoder;function tM(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t}function tH(e,t){return tM(tj.encode(e),new Uint8Array([0]),t)}function t$(e,t,r){if(t<0||t>=4294967296)throw RangeError(`value must be >= 0 and <= ${4294967296-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function tW(e){let t=new Uint8Array(4);return t$(t,e),t}function tL(e){return tM(tW(e.length),e)}async function tB(e,t,r){let a=Math.ceil((t>>3)/32),i=new Uint8Array(32*a);for(let t=0;t<a;t++){let a=new Uint8Array(4+e.length+r.length);a.set(tW(t+1)),a.set(e,4),a.set(r,4+e.length),i.set(await tD("sha256",a),32*t)}return i.slice(0,t>>3)}n=tN.Buffer.isEncoding("base64url")?e=>tN.Buffer.from(e).toString("base64url"):e=>tN.Buffer.from(e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");let tJ=e=>tN.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=tZ.decode(t)),t}(e),"base64");class tz extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null===(t=Error.captureStackTrace)||void 0===t||t.call(Error,this,this.constructor)}}class tF extends tz{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}}class tG extends tz{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}}class tV extends tz{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class tq extends tz{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class tY extends tz{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class tX extends tz{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class tQ extends tz{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class t0 extends tz{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class t1 extends tz{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class t2 extends tz{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class t4 extends tz{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator;class t6 extends tz{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}function t5(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new tq(`Unsupported JWE Algorithm: ${e}`)}}let t8=e=>(0,tO.randomFillSync)(new Uint8Array(t5(e)>>3)),t3=(e,t)=>{if(t.length<<3!==t5(e))throw new tQ("Invalid Initialization Vector length")};var t9=r(73837);let t7=t9.types.isKeyObject?e=>t9.types.isKeyObject(e):e=>null!=e&&e instanceof tO.KeyObject,re=(e,t)=>{let r;switch(e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":r=parseInt(e.slice(-3),10);break;case"A128GCM":case"A192GCM":case"A256GCM":r=parseInt(e.slice(1,4),10);break;default:throw new tq(`Content Encryption Algorithm ${e} is not supported either by JOSE or your javascript runtime`)}if(t instanceof Uint8Array){let e=t.byteLength<<3;if(e!==r)throw new tQ(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}if(t7(t)&&"secret"===t.type){let e=t.symmetricKeySize<<3;if(e!==r)throw new tQ(`Invalid Content Encryption Key length. Expected ${r} bits, got ${e} bits`);return}throw TypeError("Invalid Content Encryption Key type")},rt=tO.timingSafeEqual;function rr(e,t,r,a,i,n){let s=tM(e,t,r,function(e){let t=new Uint8Array(8);return t$(t,Math.floor(e/4294967296),0),t$(t,e%4294967296,4),t}(e.length<<3)),o=(0,tO.createHmac)(`sha${a}`,i);return o.update(s),o.digest().slice(0,n>>3)}let ra=tO.webcrypto,ri=t9.types.isCryptoKey?e=>t9.types.isCryptoKey(e):e=>!1;function rn(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function rs(e,t){return e.name===t}function ro(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!rs(e.algorithm,"AES-GCM"))throw rn("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rn(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!rs(e.algorithm,"AES-KW"))throw rn("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw rn(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw rn("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!rs(e.algorithm,"PBKDF2"))throw rn("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!rs(e.algorithm,"RSA-OAEP"))throw rn("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(parseInt(e.algorithm.hash.name.slice(4),10)!==r)throw rn(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}})(e,r)}function rd(e,t,...r){if(r.length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor&&t.constructor.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let rc=(e,...t)=>rd("Key must be ",e,...t);function rl(e,t,...r){return rd(`Key for the ${e} algorithm must be `,t,...r)}let ru=e=>(s||(s=new Set((0,tO.getCiphers)())),s.has(e)),rp=e=>t7(e)||ri(e),rh=["KeyObject"];(globalThis.CryptoKey||(null==ra?void 0:ra.CryptoKey))&&rh.push("CryptoKey");let rf=(e,t,r,a,i,n)=>{let s;if(ri(t))ro(t,e,"decrypt"),s=tO.KeyObject.from(t);else if(t instanceof Uint8Array||t7(t))s=t;else throw TypeError(rc(t,...rh,"Uint8Array"));switch(re(e,s),t3(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,a,i,n){let s,o;let d=parseInt(e.slice(1,4),10);t7(t)&&(t=t.export());let c=t.subarray(d>>3),l=t.subarray(0,d>>3),u=parseInt(e.slice(-3),10),p=`aes-${d}-cbc`;if(!ru(p))throw new tq(`alg ${e} is not supported by your javascript runtime`);let h=rr(n,a,r,u,l,d);try{s=rt(i,h)}catch{}if(!s)throw new tY;try{let e=(0,tO.createDecipheriv)(p,c,a);o=tM(e.update(r),e.final())}catch{}if(!o)throw new tY;return o}(e,s,r,a,i,n);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,a,i,n){let s=parseInt(e.slice(1,4),10),o=`aes-${s}-gcm`;if(!ru(o))throw new tq(`alg ${e} is not supported by your javascript runtime`);try{let e=(0,tO.createDecipheriv)(o,t,a,{authTagLength:16});e.setAuthTag(i),n.byteLength&&e.setAAD(n,{plaintextLength:r.length});let s=e.update(r);return e.final(),s}catch{throw new tY}}(e,s,r,a,i,n);default:throw new tq("Unsupported JWE Content Encryption Algorithm")}};var rm=r(59796);let ry=(0,t9.promisify)(rm.inflateRaw),rg=(0,t9.promisify)(rm.deflateRaw),r_=e=>ry(e,{maxOutputLength:25e4}).catch(()=>{throw new tX}),rv=e=>rg(e),rw=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function rE(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function rb(e,t){if(e.symmetricKeySize<<3!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function rk(e,t,r){if(t7(e))return e;if(e instanceof Uint8Array)return(0,tO.createSecretKey)(e);if(ri(e))return ro(e,t,r),tO.KeyObject.from(e);throw TypeError(rc(e,...rh,"Uint8Array"))}let rx=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),i=`aes${a}-wrap`;if(!ru(i))throw new tq(`alg ${e} is not supported either by JOSE or your javascript runtime`);let n=rk(t,e,"wrapKey");rb(n,e);let s=(0,tO.createCipheriv)(i,n,tN.Buffer.alloc(8,166));return tM(s.update(r),s.final())},rS=(e,t,r)=>{let a=parseInt(e.slice(1,4),10),i=`aes${a}-wrap`;if(!ru(i))throw new tq(`alg ${e} is not supported either by JOSE or your javascript runtime`);let n=rk(t,e,"unwrapKey");rb(n,e);let s=(0,tO.createDecipheriv)(i,n,tN.Buffer.alloc(8,166));return tM(s.update(r),s.final())},rT=tN.Buffer.from([42,134,72,206,61,3,1,7]),rA=tN.Buffer.from([43,129,4,0,34]),rO=tN.Buffer.from([43,129,4,0,35]),rR=tN.Buffer.from([43,129,4,0,10]),rC=new WeakMap,rP=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new tq("Unsupported key curve for this operation")}},rI=(e,t)=>{var r;let a;if(ri(e))a=tO.KeyObject.from(e);else if(t7(e))a=e;else throw TypeError(rc(e,...rh));if("secret"===a.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(a.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${a.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${a.asymmetricKeyType.slice(1)}`;case"ec":{if(rC.has(a))return rC.get(a);let e=null===(r=a.asymmetricKeyDetails)||void 0===r?void 0:r.namedCurve;if(e||"private"!==a.type){if(!e){let t=a.export({format:"der",type:"spki"}),r=t[1]<128?14:15,i=t[r],n=t.slice(r+1,r+1+i);if(n.equals(rT))e="prime256v1";else if(n.equals(rA))e="secp384r1";else if(n.equals(rO))e="secp521r1";else if(n.equals(rR))e="secp256k1";else throw new tq("Unsupported key curve for this operation")}}else e=rI((0,tO.createPublicKey)(a),!0);if(t)return e;let i=rP(e);return rC.set(a,i),i}default:throw TypeError("Invalid asymmetric key type for this operation")}},rU=(0,t9.promisify)(tO.generateKeyPair);async function rK(e,t,r,a,i=new Uint8Array(0),n=new Uint8Array(0)){let s,o;if(ri(e))ro(e,"ECDH"),s=tO.KeyObject.from(e);else if(t7(e))s=e;else throw TypeError(rc(e,...rh));if(ri(t))ro(t,"ECDH","deriveBits"),o=tO.KeyObject.from(t);else if(t7(t))o=t;else throw TypeError(rc(t,...rh));let d=tM(tL(tj.encode(r)),tL(i),tL(n),tW(a));return tB((0,tO.diffieHellman)({privateKey:o,publicKey:s}),a,d)}async function rN(e){let t;if(ri(e))t=tO.KeyObject.from(e);else if(t7(e))t=e;else throw TypeError(rc(e,...rh));switch(t.asymmetricKeyType){case"x25519":return rU("x25519");case"x448":return rU("x448");case"ec":return rU("ec",{namedCurve:rI(t)});default:throw new tq("Invalid or unsupported EPK")}}let rD=e=>["P-256","P-384","P-521","X25519","X448"].includes(rI(e));function rj(e){if(!(e instanceof Uint8Array)||e.length<8)throw new tQ("PBES2 Salt Input must be 8 or more octets")}let rZ=(0,t9.promisify)(tO.pbkdf2);function rM(e,t){if(t7(e))return e.export();if(e instanceof Uint8Array)return e;if(ri(e))return ro(e,t,"deriveBits","deriveKey"),tO.KeyObject.from(e).export();throw TypeError(rc(e,...rh,"Uint8Array"))}let rH=async(e,t,r,a=2048,i=(0,tO.randomFillSync)(new Uint8Array(16)))=>{rj(i);let s=tH(e,i),o=parseInt(e.slice(13,16),10)>>3,d=rM(t,e),c=await rZ(d,s,a,o,`sha${e.slice(8,11)}`);return{encryptedKey:await rx(e.slice(-6),c,r),p2c:a,p2s:n(i)}},r$=async(e,t,r,a,i)=>{rj(i);let n=tH(e,i),s=parseInt(e.slice(13,16),10)>>3,o=rM(t,e),d=await rZ(o,n,a,s,`sha${e.slice(8,11)}`);return rS(e.slice(-6),d,r)},rW=new WeakMap,rL=(e,t)=>{let r=e.readUInt8(1);if((128&r)==0)return 0===t?r:rL(e.subarray(2+r),t-1);let a=127&r;r=0;for(let t=0;t<a;t++)r<<=8,r|=e.readUInt8(2+t);return 0===t?r:rL(e.subarray(2+r),t-1)},rB=(e,t)=>{let r=e.readUInt8(1);return(128&r)==0?rL(e.subarray(2),t):rL(e.subarray(2+(127&r)),t)},rJ=e=>{var t,r;if(rW.has(e))return rW.get(e);let a=null!==(r=null===(t=e.asymmetricKeyDetails)||void 0===t?void 0:t.modulusLength)&&void 0!==r?r:rB(e.export({format:"der",type:"pkcs1"}),"private"===e.type?1:0)-1<<3;return rW.set(e,a),a},rz=(e,t)=>{rW.set(e,t)},rF=(e,t)=>{if(2048>rJ(e))throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},rG=(e,t)=>{if("rsa"!==e.asymmetricKeyType)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");rF(e,t)},rV=e=>{switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return tO.constants.RSA_PKCS1_OAEP_PADDING;case"RSA1_5":return tO.constants.RSA_PKCS1_PADDING;default:return}},rq=e=>{switch(e){case"RSA-OAEP":return"sha1";case"RSA-OAEP-256":return"sha256";case"RSA-OAEP-384":return"sha384";case"RSA-OAEP-512":return"sha512";default:return}};function rY(e,t,...r){if(t7(e))return e;if(ri(e))return ro(e,t,...r),tO.KeyObject.from(e);throw TypeError(rc(e,...rh))}let rX=(e,t,r)=>{let a=rV(e),i=rq(e),n=rY(t,e,"wrapKey","encrypt");return rG(n,e),(0,tO.publicEncrypt)({key:n,oaepHash:i,padding:a},r)},rQ=(e,t,r)=>{let a=rV(e),i=rq(e),n=rY(t,e,"unwrapKey","decrypt");return rG(n,e),(0,tO.privateDecrypt)({key:n,oaepHash:i,padding:a},r)};function r0(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new tq(`Unsupported JWE Algorithm: ${e}`)}}let r1=e=>(0,tO.randomFillSync)(new Uint8Array(r0(e)>>3)),r2=tN.Buffer.from([0]),r4=tN.Buffer.from([2]),r6=tN.Buffer.from([3]),r5=tN.Buffer.from([48]),r8=tN.Buffer.from([4]),r3=e=>{if(e<128)return tN.Buffer.from([e]);let t=tN.Buffer.alloc(5);t.writeUInt32BE(e,1);let r=1;for(;0===t[r];)r++;return t[r-1]=128|5-r,t.slice(r-1)},r9=new Map([["P-256",tN.Buffer.from("06 08 2A 86 48 CE 3D 03 01 07".replace(/ /g,""),"hex")],["secp256k1",tN.Buffer.from("06 05 2B 81 04 00 0A".replace(/ /g,""),"hex")],["P-384",tN.Buffer.from("06 05 2B 81 04 00 22".replace(/ /g,""),"hex")],["P-521",tN.Buffer.from("06 05 2B 81 04 00 23".replace(/ /g,""),"hex")],["ecPublicKey",tN.Buffer.from("06 07 2A 86 48 CE 3D 02 01".replace(/ /g,""),"hex")],["X25519",tN.Buffer.from("06 03 2B 65 6E".replace(/ /g,""),"hex")],["X448",tN.Buffer.from("06 03 2B 65 6F".replace(/ /g,""),"hex")],["Ed25519",tN.Buffer.from("06 03 2B 65 70".replace(/ /g,""),"hex")],["Ed448",tN.Buffer.from("06 03 2B 65 71".replace(/ /g,""),"hex")]]);class r7{constructor(){this.length=0,this.elements=[]}oidFor(e){let t=r9.get(e);if(!t)throw new tq("Invalid or unsupported OID");this.elements.push(t),this.length+=t.length}zero(){this.elements.push(r4,tN.Buffer.from([1]),r2),this.length+=3}one(){this.elements.push(r4,tN.Buffer.from([1]),tN.Buffer.from([1])),this.length+=3}unsignedInteger(e){if(128&e[0]){let t=r3(e.length+1);this.elements.push(r4,t,r2,e),this.length+=2+t.length+e.length}else{let t=0;for(;0===e[t]&&(128&e[t+1])==0;)t++;let r=r3(e.length-t);this.elements.push(r4,r3(e.length-t),e.slice(t)),this.length+=1+r.length+e.length-t}}octStr(e){let t=r3(e.length);this.elements.push(r8,r3(e.length),e),this.length+=1+t.length+e.length}bitStr(e){let t=r3(e.length+1);this.elements.push(r6,r3(e.length+1),r2,e),this.length+=1+t.length+e.length+1}add(e){this.elements.push(e),this.length+=e.length}end(e=r5){let t=r3(this.length);return tN.Buffer.concat([e,t,...this.elements],1+t.length+this.length)}}let[ae,at]=process.versions.node.split(".").map(e=>parseInt(e,10));process.versions;let ar=ae>=16||15===ae&&at>=9,aa=ae>=16||15===ae&&at>=12,ai=e=>{if(aa&&"oct"!==e.kty)return e.d?(0,tO.createPrivateKey)({format:"jwk",key:e}):(0,tO.createPublicKey)({format:"jwk",key:e});switch(e.kty){case"oct":return(0,tO.createSecretKey)(tJ(e.k));case"RSA":{let t=new r7,r=void 0!==e.d,a=tN.Buffer.from(e.n,"base64"),i=tN.Buffer.from(e.e,"base64");r?(t.zero(),t.unsignedInteger(a),t.unsignedInteger(i),t.unsignedInteger(tN.Buffer.from(e.d,"base64")),t.unsignedInteger(tN.Buffer.from(e.p,"base64")),t.unsignedInteger(tN.Buffer.from(e.q,"base64")),t.unsignedInteger(tN.Buffer.from(e.dp,"base64")),t.unsignedInteger(tN.Buffer.from(e.dq,"base64")),t.unsignedInteger(tN.Buffer.from(e.qi,"base64"))):(t.unsignedInteger(a),t.unsignedInteger(i));let n={key:t.end(),format:"der",type:"pkcs1"},s=r?(0,tO.createPrivateKey)(n):(0,tO.createPublicKey)(n);return rz(s,a.length<<3),s}case"EC":{var t,r;let a=new r7,i=void 0!==e.d,n=tN.Buffer.concat([tN.Buffer.alloc(1,4),tN.Buffer.from(e.x,"base64"),tN.Buffer.from(e.y,"base64")]);if(i){a.zero();let r=new r7;r.oidFor("ecPublicKey"),r.oidFor(e.crv),a.add(r.end());let i=new r7;i.one(),i.octStr(tN.Buffer.from(e.d,"base64"));let s=new r7;s.bitStr(n);let o=s.end(tN.Buffer.from([161]));i.add(o);let d=i.end(),c=new r7;c.add(d);let l=c.end(tN.Buffer.from([4]));a.add(l);let u=a.end(),p=(0,tO.createPrivateKey)({key:u,format:"der",type:"pkcs8"});return t=e.crv,rC.set(p,t),p}let s=new r7;s.oidFor("ecPublicKey"),s.oidFor(e.crv),a.add(s.end()),a.bitStr(n);let o=a.end(),d=(0,tO.createPublicKey)({key:o,format:"der",type:"spki"});return r=e.crv,rC.set(d,r),d}case"OKP":{let t=new r7;if(void 0!==e.d){t.zero();let r=new r7;r.oidFor(e.crv),t.add(r.end());let a=new r7;a.octStr(tN.Buffer.from(e.d,"base64"));let i=a.end(tN.Buffer.from([4]));t.add(i);let n=t.end();return(0,tO.createPrivateKey)({key:n,format:"der",type:"pkcs8"})}let r=new r7;r.oidFor(e.crv),t.add(r.end()),t.bitStr(tN.Buffer.from(e.x,"base64"));let a=t.end();return(0,tO.createPublicKey)({key:a,format:"der",type:"spki"})}default:throw new tq('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}};async function an(e,t,r){var a;if(!rE(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=r||(r=!0!==e.ext),r)return ai({...e,alg:t,ext:null!==(a=e.ext)&&void 0!==a&&a});return tJ(e.k);case"RSA":if(void 0!==e.oth)throw new tq('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return ai({...e,alg:t});default:throw new tq('Unsupported "kty" (Key Type) Parameter value')}}let as=(e,t)=>{if(!(t instanceof Uint8Array)){if(!rp(t))throw TypeError(rl(e,t,...rh,"Uint8Array"));if("secret"!==t.type)throw TypeError(`${rh.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},ao=(e,t,r)=>{if(!rp(t))throw TypeError(rl(e,t,...rh));if("secret"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${rh.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},ad=(e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?as(e,t):ao(e,t,r)},ac=(e,t,r,a,i)=>{let n;if(ri(r))ro(r,e,"encrypt"),n=tO.KeyObject.from(r);else if(r instanceof Uint8Array||t7(r))n=r;else throw TypeError(rc(r,...rh,"Uint8Array"));switch(re(e,n),t3(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return function(e,t,r,a,i){let n=parseInt(e.slice(1,4),10);t7(r)&&(r=r.export());let s=r.subarray(n>>3),o=r.subarray(0,n>>3),d=`aes-${n}-cbc`;if(!ru(d))throw new tq(`alg ${e} is not supported by your javascript runtime`);let c=(0,tO.createCipheriv)(d,s,a),l=tM(c.update(t),c.final()),u=rr(i,a,l,parseInt(e.slice(-3),10),o,n);return{ciphertext:l,tag:u}}(e,t,n,a,i);case"A128GCM":case"A192GCM":case"A256GCM":return function(e,t,r,a,i){let n=parseInt(e.slice(1,4),10),s=`aes-${n}-gcm`;if(!ru(s))throw new tq(`alg ${e} is not supported by your javascript runtime`);let o=(0,tO.createCipheriv)(s,r,a,{authTagLength:16});i.byteLength&&o.setAAD(i,{plaintextLength:t.length});let d=o.update(t);return o.final(),{ciphertext:d,tag:o.getAuthTag()}}(e,t,n,a,i);default:throw new tq("Unsupported JWE Content Encryption Algorithm")}};async function al(e,t,r,a){let i=e.slice(0,7);a||(a=t8(i));let{ciphertext:s,tag:o}=await ac(i,r,t,a,new Uint8Array(0));return{encryptedKey:s,iv:n(a),tag:n(o)}}async function au(e,t,r,a,i){return rf(e.slice(0,7),t,r,a,i,new Uint8Array(0))}async function ap(e,t,r,a,i){switch(ad(e,t,"decrypt"),e){case"dir":if(void 0!==r)throw new tQ("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new tQ("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i,n;if(!rE(a.epk))throw new tQ('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!rD(t))throw new tq("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await an(a.epk,e);if(void 0!==a.apu){if("string"!=typeof a.apu)throw new tQ('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{i=tJ(a.apu)}catch{throw new tQ("Failed to base64url decode the apu")}}if(void 0!==a.apv){if("string"!=typeof a.apv)throw new tQ('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{n=tJ(a.apv)}catch{throw new tQ("Failed to base64url decode the apv")}}let o=await rK(s,t,"ECDH-ES"===e?a.enc:e,"ECDH-ES"===e?r0(a.enc):parseInt(e.slice(-5,-2),10),i,n);if("ECDH-ES"===e)return o;if(void 0===r)throw new tQ("JWE Encrypted Key missing");return rS(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new tQ("JWE Encrypted Key missing");return rQ(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let n;if(void 0===r)throw new tQ("JWE Encrypted Key missing");if("number"!=typeof a.p2c)throw new tQ('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=(null==i?void 0:i.maxPBES2Count)||1e4;if(a.p2c>s)throw new tQ('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof a.p2s)throw new tQ('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{n=tJ(a.p2s)}catch{throw new tQ("Failed to base64url decode the p2s")}return r$(e,t,r,a.p2c,n)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new tQ("JWE Encrypted Key missing");return rS(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let i,n;if(void 0===r)throw new tQ("JWE Encrypted Key missing");if("string"!=typeof a.iv)throw new tQ('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof a.tag)throw new tQ('JOSE Header "tag" (Authentication Tag) missing or invalid');try{i=tJ(a.iv)}catch{throw new tQ("Failed to base64url decode the iv")}try{n=tJ(a.tag)}catch{throw new tQ("Failed to base64url decode the tag")}return au(e,t,r,i,n)}default:throw new tq('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let ah=function(e,t,r,a,i){let n;if(void 0!==i.crit&&void 0===a.crit)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!n.has(s))throw new tq(`Extension Header Parameter "${s}" is not recognized`);if(void 0===i[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(n.get(s)&&void 0===a[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(a.crit)},af=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function am(e,t,r){var a;let i,n,s,o,d,c,l;if(!rE(e))throw new tQ("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new tQ("JOSE Header missing");if("string"!=typeof e.iv)throw new tQ("JWE Initialization Vector missing or incorrect type");if("string"!=typeof e.ciphertext)throw new tQ("JWE Ciphertext missing or incorrect type");if("string"!=typeof e.tag)throw new tQ("JWE Authentication Tag missing or incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new tQ("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new tQ("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new tQ("JWE AAD incorrect type");if(void 0!==e.header&&!rE(e.header))throw new tQ("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!rE(e.unprotected))throw new tQ("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=tJ(e.protected);i=JSON.parse(tZ.decode(t))}catch{throw new tQ("JWE Protected Header is invalid")}if(!rw(i,e.header,e.unprotected))throw new tQ("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let u={...i,...e.header,...e.unprotected};if(ah(tQ,new Map,null==r?void 0:r.crit,i,u),void 0!==u.zip){if(!i||!i.zip)throw new tQ('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==u.zip)throw new tq('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:p,enc:h}=u;if("string"!=typeof p||!p)throw new tQ("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof h||!h)throw new tQ("missing JWE Encryption Algorithm (enc) in JWE Header");let f=r&&af("keyManagementAlgorithms",r.keyManagementAlgorithms),m=r&&af("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(f&&!f.has(p))throw new tV('"alg" (Algorithm) Header Parameter not allowed');if(m&&!m.has(h))throw new tV('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==e.encrypted_key)try{n=tJ(e.encrypted_key)}catch{throw new tQ("Failed to base64url decode the encrypted_key")}let y=!1;"function"==typeof t&&(t=await t(i,e),y=!0);try{s=await ap(p,t,n,u,r)}catch(e){if(e instanceof TypeError||e instanceof tQ||e instanceof tq)throw e;s=r1(h)}try{o=tJ(e.iv)}catch{throw new tQ("Failed to base64url decode the iv")}try{d=tJ(e.tag)}catch{throw new tQ("Failed to base64url decode the tag")}let g=tj.encode(null!==(a=e.protected)&&void 0!==a?a:"");c=void 0!==e.aad?tM(g,tj.encode("."),tj.encode(e.aad)):g;try{l=tJ(e.ciphertext)}catch{throw new tQ("Failed to base64url decode the ciphertext")}let _=await rf(h,s,l,o,d,c);"DEF"===u.zip&&(_=await ((null==r?void 0:r.inflateRaw)||r_)(_));let v={plaintext:_};if(void 0!==e.protected&&(v.protectedHeader=i),void 0!==e.aad)try{v.additionalAuthenticatedData=tJ(e.aad)}catch{throw new tQ("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(v.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(v.unprotectedHeader=e.header),y)?{...v,key:t}:v}async function ay(e,t,r){if(e instanceof Uint8Array&&(e=tZ.decode(e)),"string"!=typeof e)throw new tQ("Compact JWE must be a string or Uint8Array");let{0:a,1:i,2:n,3:s,4:o,length:d}=e.split(".");if(5!==d)throw new tQ("Invalid Compact JWE");let c=await am({ciphertext:s,iv:n||void 0,protected:a||void 0,tag:o||void 0,encrypted_key:i||void 0},t,r),l={plaintext:c.plaintext,protectedHeader:c.protectedHeader};return"function"==typeof t?{...l,key:c.key}:l}class ag{constructor(e){if(48!==e[0]||(this.buffer=e,this.offset=1,this.decodeLength()!==e.length-this.offset))throw TypeError()}decodeLength(){let e=this.buffer[this.offset++];if(128&e){let t=-129&e;e=0;for(let r=0;r<t;r++)e=e<<8|this.buffer[this.offset+r];this.offset+=t}return e}unsignedInteger(){if(2!==this.buffer[this.offset++])throw TypeError();let e=this.decodeLength();0===this.buffer[this.offset]&&(this.offset++,e--);let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}end(){if(this.offset!==this.buffer.length)throw TypeError()}}let a_=e=>{let t;if(ri(e)){if(!e.extractable)throw TypeError("CryptoKey is not extractable");t=tO.KeyObject.from(e)}else if(t7(e))t=e;else if(e instanceof Uint8Array)return{kty:"oct",k:n(e)};else throw TypeError(rc(e,...rh,"Uint8Array"));if(ar){if("secret"!==t.type&&!["rsa","ec","ed25519","x25519","ed448","x448"].includes(t.asymmetricKeyType))throw new tq("Unsupported key asymmetricKeyType");return t.export({format:"jwk"})}switch(t.type){case"secret":return{kty:"oct",k:n(t.export())};case"private":case"public":switch(t.asymmetricKeyType){case"rsa":{let e;let r=new ag(t.export({format:"der",type:"pkcs1"}));"private"===t.type&&r.unsignedInteger();let a=n(r.unsignedInteger()),i=n(r.unsignedInteger());return"private"===t.type&&(e={d:n(r.unsignedInteger()),p:n(r.unsignedInteger()),q:n(r.unsignedInteger()),dp:n(r.unsignedInteger()),dq:n(r.unsignedInteger()),qi:n(r.unsignedInteger())}),r.end(),{kty:"RSA",n:a,e:i,...e}}case"ec":{let e,r,a;let i=rI(t);switch(i){case"secp256k1":e=64,r=33,a=-1;break;case"P-256":e=64,r=36,a=-1;break;case"P-384":e=96,r=35,a=-3;break;case"P-521":e=132,r=35,a=-3;break;default:throw new tq("Unsupported curve")}if("public"===t.type){let r=t.export({type:"spki",format:"der"});return{kty:"EC",crv:i,x:n(r.subarray(-e,-e/2)),y:n(r.subarray(-e/2))}}let s=t.export({type:"pkcs8",format:"der"});return s.length<100&&(r+=a),{...a_((0,tO.createPublicKey)(t)),d:n(s.subarray(r,r+e/2))}}case"ed25519":case"x25519":{let e=rI(t);if("public"===t.type)return{kty:"OKP",crv:e,x:n(t.export({type:"spki",format:"der"}).subarray(-32))};let r=t.export({type:"pkcs8",format:"der"});return{...a_((0,tO.createPublicKey)(t)),d:n(r.subarray(-32))}}case"ed448":case"x448":{let e=rI(t);if("public"===t.type)return{kty:"OKP",crv:e,x:n(t.export({type:"spki",format:"der"}).subarray("Ed448"===e?-57:-56))};let r=t.export({type:"pkcs8",format:"der"});return{...a_((0,tO.createPublicKey)(t)),d:n(r.subarray("Ed448"===e?-57:-56))}}default:throw new tq("Unsupported key asymmetricKeyType")}default:throw new tq("Unsupported key type")}};async function av(e){return a_(e)}async function aw(e,t,r,a,i={}){let s,o,d;switch(ad(e,r,"encrypt"),e){case"dir":d=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!rD(r))throw new tq("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:l}=i,{epk:u}=i;u||(u=(await rN(r)).privateKey);let{x:p,y:h,crv:f,kty:m}=await av(u),y=await rK(r,u,"ECDH-ES"===e?t:e,"ECDH-ES"===e?r0(t):parseInt(e.slice(-5,-2),10),c,l);if(o={epk:{x:p,crv:f,kty:m}},"EC"===m&&(o.epk.y=h),c&&(o.apu=n(c)),l&&(o.apv=n(l)),"ECDH-ES"===e){d=y;break}d=a||r1(t);let g=e.slice(-6);s=await rx(g,y,d);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":d=a||r1(t),s=await rX(e,r,d);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{d=a||r1(t);let{p2c:n,p2s:c}=i;({encryptedKey:s,...o}=await rH(e,r,d,n,c));break}case"A128KW":case"A192KW":case"A256KW":d=a||r1(t),s=await rx(e,r,d);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{d=a||r1(t);let{iv:n}=i;({encryptedKey:s,...o}=await al(e,r,d,n));break}default:throw new tq('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:d,encryptedKey:s,parameters:o}}let aE=Symbol();class ab{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,a,i,s,o,d,c;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new tQ("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!rw(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new tQ("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let l={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(ah(tQ,new Map,null==t?void 0:t.crit,this._protectedHeader,l),void 0!==l.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new tQ('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==l.zip)throw new tq('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:u,enc:p}=l;if("string"!=typeof u||!u)throw new tQ('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof p||!p)throw new tQ('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===u){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===u&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let i;({cek:a,encryptedKey:r,parameters:i}=await aw(u,p,e,this._cek,this._keyManagementParameters)),i&&(t&&aE in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...i}:this.setUnprotectedHeader(i):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...i}:this.setProtectedHeader(i))}if(this._iv||(this._iv=t8(p)),s=this._protectedHeader?tj.encode(n(JSON.stringify(this._protectedHeader))):tj.encode(""),this._aad?(o=n(this._aad),i=tM(s,tj.encode("."),tj.encode(o))):i=s,"DEF"===l.zip){let e=await ((null==t?void 0:t.deflateRaw)||rv)(this._plaintext);({ciphertext:d,tag:c}=await ac(p,e,a,this._iv,i))}else({ciphertext:d,tag:c}=await ac(p,this._plaintext,a,this._iv,i));let h={ciphertext:n(d),iv:n(this._iv),tag:n(c)};return r&&(h.encrypted_key=n(r)),o&&(h.aad=o),this._protectedHeader&&(h.protected=tZ.decode(s)),this._sharedUnprotectedHeader&&(h.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(h.header=this._unprotectedHeader),h}}tO.constants.RSA_PKCS1_PSS_PADDING,tO.constants.RSA_PSS_SALTLEN_DIGEST,tO.sign.length>3?(0,t9.promisify)(tO.sign):tO.sign,tO.verify.length>4&&(ae>=16||15===ae&&at>=13)?(0,t9.promisify)(tO.verify):tO.verify;let ak=e=>Math.floor(e.getTime()/1e3),ax=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,aS=e=>{let t=ax.exec(e);if(!t)throw TypeError("Invalid time period format");let r=parseFloat(t[1]);switch(t[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*r);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*r);case"day":case"days":case"d":return Math.round(86400*r);case"week":case"weeks":case"w":return Math.round(604800*r);default:return Math.round(31557600*r)}},aT=e=>e.toLowerCase().replace(/^application\//,""),aA=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),aO=(e,t,r={})=>{let a,i;let{typ:n}=r;if(n&&("string"!=typeof e.typ||aT(e.typ)!==aT(n)))throw new tF('unexpected "typ" JWT header value',"typ","check_failed");try{a=JSON.parse(tZ.decode(t))}catch{}if(!rE(a))throw new t0("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:o,subject:d,audience:c,maxTokenAge:l}=r;for(let e of(void 0!==l&&s.push("iat"),void 0!==c&&s.push("aud"),void 0!==d&&s.push("sub"),void 0!==o&&s.push("iss"),new Set(s.reverse())))if(!(e in a))throw new tF(`missing required "${e}" claim`,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(a.iss))throw new tF('unexpected "iss" claim value',"iss","check_failed");if(d&&a.sub!==d)throw new tF('unexpected "sub" claim value',"sub","check_failed");if(c&&!aA(a.aud,"string"==typeof c?[c]:c))throw new tF('unexpected "aud" claim value',"aud","check_failed");switch(typeof r.clockTolerance){case"string":i=aS(r.clockTolerance);break;case"number":i=r.clockTolerance;break;case"undefined":i=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:u}=r,p=ak(u||new Date);if((void 0!==a.iat||l)&&"number"!=typeof a.iat)throw new tF('"iat" claim must be a number',"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new tF('"nbf" claim must be a number',"nbf","invalid");if(a.nbf>p+i)throw new tF('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new tF('"exp" claim must be a number',"exp","invalid");if(a.exp<=p-i)throw new tG('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let e=p-a.iat;if(e-i>("number"==typeof l?l:aS(l)))throw new tG('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(e<0-i)throw new tF('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return a};async function aR(e,t,r){let a=await ay(e,t,r),i=aO(a.protectedHeader,a.plaintext,r),{protectedHeader:n}=a;if(void 0!==n.iss&&n.iss!==i.iss)throw new tF('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==n.sub&&n.sub!==i.sub)throw new tF('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==n.aud&&JSON.stringify(n.aud)!==JSON.stringify(i.aud))throw new tF('replicated "aud" claim header parameter mismatch',"aud","mismatch");let s={payload:i,protectedHeader:n};return"function"==typeof t?{...s,key:a.key}:s}class aC{constructor(e){this._flattened=new ab(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}class aP{constructor(e){if(!rE(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:ak(new Date)+aS(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:ak(new Date)+aS(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:ak(new Date)}:this._payload={...this._payload,iat:e},this}}class aI extends aP{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new aC(tj.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}function aU(e){return rE(e)}async function aK(e,t,r){let a=e.get(t)||e.set(t,{}).get(t);if(void 0===a[r]){let e=await an({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new t1("JSON Web Key Set members must be public keys");a[r]=e}return a[r]}var aN=r(13685),aD=r(95687),aj=r(82361);(0,t9.promisify)(tO.generateKeyPair);let aZ={randomUUID:tR().randomUUID},aM=new Uint8Array(256),aH=aM.length,a$=[];for(let e=0;e<256;++e)a$.push((e+256).toString(16).slice(1));let aW=function(e,t,r){if(aZ.randomUUID&&!t&&!e)return aZ.randomUUID();let a=(e=e||{}).random||(e.rng||function(){return aH>aM.length-16&&(tR().randomFillSync(aM),aH=0),aM.slice(aH,aH+=16)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return a$[e[t+0]]+a$[e[t+1]]+a$[e[t+2]]+a$[e[t+3]]+"-"+a$[e[t+4]]+a$[e[t+5]]+"-"+a$[e[t+6]]+a$[e[t+7]]+"-"+a$[e[t+8]]+a$[e[t+9]]+"-"+a$[e[t+10]]+a$[e[t+11]]+a$[e[t+12]]+a$[e[t+13]]+a$[e[t+14]]+a$[e[t+15]]}(a)},aL=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","image/tiff","image/bmp","image/x-icon"];async function aB(e){let t=globalThis._EDGE_STORE_LOGGER,{ctx:r,provider:a,router:i}=e;t.debug("Running [init]",{ctx:r});let n=await aq(r),{token:s}=await a.init({ctx:r,router:i}),o=[(0,tK.serialize)("edgestore-ctx",n,{path:"/",maxAge:2592e3})];s&&o.push((0,tK.serialize)("edgestore-token",s,{path:"/",maxAge:2592e3}));let d=await a.getBaseUrl();return t.debug("Finished [init]",{ctx:r,newCookies:o,token:s,baseUrl:d}),{newCookies:o,token:s,baseUrl:d}}async function aJ(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,input:n,fileInfo:s}}=e,o=globalThis._EDGE_STORE_LOGGER;if(o.debug("Running [requestUpload]",{bucketName:i,input:n,fileInfo:s}),!a)throw new tf({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let d=await aQ(a);o.debug("Decrypted Context",{ctx:d});let c=r.buckets[i];if(!c)throw new tf({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});if(c._def.beforeUpload){o.debug("Running [beforeUpload]");let e=await c._def.beforeUpload?.({ctx:d,input:n,fileInfo:{size:s.size,type:s.type,fileName:s.fileName,extension:s.extension,replaceTargetUrl:s.replaceTargetUrl,temporary:s.temporary}});if(o.debug("Finished [beforeUpload]",{canUpload:e}),!e)throw new tf({message:"Upload not allowed for the current context",code:"UPLOAD_NOT_ALLOWED"})}if("IMAGE"===c._def.type&&!aL.includes(s.type))throw new tf({code:"MIME_TYPE_NOT_ALLOWED",message:"Only images are allowed in this bucket",details:{allowedMimeTypes:aL,mimeType:s.type}});if(c._def.bucketConfig?.maxSize&&s.size>c._def.bucketConfig.maxSize)throw new tf({code:"FILE_TOO_LARGE",message:`File size is too big. Max size is ${c._def.bucketConfig.maxSize}`,details:{maxFileSize:c._def.bucketConfig.maxSize,fileSize:s.size}});if(c._def.bucketConfig?.accept){let e=c._def.bucketConfig.accept,t=!1;for(let r of e)if(r.endsWith("/*")){let e=r.replace("/*","");if(s.type.startsWith(e)){t=!0;break}}else if(s.type===r){t=!0;break}if(!t)throw new tf({code:"MIME_TYPE_NOT_ALLOWED",message:`"${s.type}" is not allowed. Accepted types are ${JSON.stringify(e)}`,details:{allowedMimeTypes:e,mimeType:s.type}})}let l=function(e){let{bucket:t}=e,r=t._def.path;return r.map(t=>{let a=Object.entries(t);if(void 0===a[0])throw new tf({message:`Empty path param found in: ${JSON.stringify(r)}`,code:"SERVER_ERROR"});let[i,n]=a[0];return{key:i,value:n().split(".").reduce((e,t)=>{if(void 0===e[t])throw new tf({message:`Missing key ${t} in ${JSON.stringify(e)}`,code:"BAD_REQUEST"});return e[t]},e.pathAttrs)}})}({fileInfo:s,bucket:c,pathAttrs:{ctx:d,input:n}}),u=await c._def.metadata?.({ctx:d,input:n}),p=void 0===c._def.accessControl;o.debug("upload info",{path:l,metadata:u,isPublic:p,bucketType:c._def.type});let h=await t.requestUpload({bucketName:i,bucketType:c._def.type,fileInfo:{...s,path:l,isPublic:p,metadata:u}}),{parsedPath:f,pathOrder:m}={parsedPath:l.reduce((e,t)=>(e[t.key]=t.value,e),{}),pathOrder:l.map(e=>e.key)};return o.debug("Finished [requestUpload]"),{...h,size:s.size,uploadedAt:new Date().toISOString(),path:f,pathOrder:m,metadata:u}}async function az(e){let{provider:t,ctxToken:r,body:{multipart:a,path:i}}=e,n=globalThis._EDGE_STORE_LOGGER;if(n.debug("Running [requestUploadParts]",{multipart:a,path:i}),!r)throw new tf({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await aQ(r);let s=await t.requestUploadParts({multipart:a,path:i});return n.debug("Finished [requestUploadParts]"),s}async function aF(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,uploadId:n,key:s,parts:o}}=e,d=globalThis._EDGE_STORE_LOGGER;if(d.debug("Running [completeMultipartUpload]",{bucketName:i,uploadId:n,key:s}),!a)throw new tf({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});if(await aQ(a),!r.buckets[i])throw new tf({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});let c=await t.completeMultipartUpload({uploadId:n,key:s,parts:o});return d.debug("Finished [completeMultipartUpload]"),c}async function aG(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,url:n}}=e,s=globalThis._EDGE_STORE_LOGGER;if(s.debug("Running [confirmUpload]",{bucketName:i,url:n}),!a)throw new tf({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});await aQ(a);let o=r.buckets[i];if(!o)throw new tf({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});let d=await t.confirmUpload({bucket:o,url:n});return s.debug("Finished [confirmUpload]"),d}async function aV(e){let{provider:t,router:r,ctxToken:a,body:{bucketName:i,url:n}}=e,s=globalThis._EDGE_STORE_LOGGER;if(s.debug("Running [deleteFile]",{bucketName:i,url:n}),!a)throw new tf({message:"Missing edgestore-ctx cookie",code:"UNAUTHORIZED"});let o=await aQ(a),d=r.buckets[i];if(!d)throw new tf({message:`Bucket ${i} not found`,code:"BAD_REQUEST"});if(!d._def.beforeDelete)throw new tf({message:"You need to define beforeDelete if you want to delete files directly from the frontend.",code:"SERVER_ERROR"});let c=await t.getFile({url:n});if(!await d._def.beforeDelete({ctx:o,fileInfo:c}))throw new tf({message:"Delete not allowed for the current context",code:"DELETE_NOT_ALLOWED"});let l=await t.deleteFile({bucket:d,url:n});return s.debug("Finished [deleteFile]"),l}async function aq(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new tf({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await aX(t);return await new aI(e).setProtectedHeader({alg:"dir",enc:"A256GCM"}).setIssuedAt().setExpirationTime(Date.now()/1e3+2592e3).setJti(aW()).encrypt(r)}async function aY(e){let t=process.env.EDGE_STORE_JWT_SECRET??process.env.EDGE_STORE_SECRET_KEY;if(!t)throw new tf({message:"EDGE_STORE_JWT_SECRET or EDGE_STORE_SECRET_KEY is not defined",code:"SERVER_ERROR"});let r=await aX(t),{payload:a}=await aR(e,r,{clockTolerance:15});return a}async function aX(e){return await tU("sha256",e,"","Edge Store Generated Encryption Key",32)}async function aQ(e){return await aY(e)}let a0=tv.create(),a1=function(e){let{provider:t=function(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=(void 0)??{},a=process.env.EDGE_STORE_BASE_URL??"https://files.edgestore.dev";if(!t||!r)throw new tx;let i=function(e){let{accessKey:t=process.env.EDGE_STORE_ACCESS_KEY,secretKey:r=process.env.EDGE_STORE_SECRET_KEY}=e??{};if(!t||!r)throw new tx;return{getToken:async e=>await tA.getToken({accessKey:t,secretKey:r,ctx:e.ctx,router:e.router}),getFile:async({url:e})=>await tA.getFile({accessKey:t,secretKey:r,url:e}),requestUpload:async({bucketName:e,bucketType:a,fileInfo:i,multipart:n})=>await tA.requestUpload({accessKey:t,secretKey:r,bucketName:e,bucketType:a,fileInfo:i,multipart:n}),requestUploadParts:async({key:e,multipart:a})=>await tA.requestUploadParts({accessKey:t,secretKey:r,key:e,multipart:a}),completeMultipartUpload:async({uploadId:e,key:a,parts:i})=>await tA.completeMultipartUpload({accessKey:t,secretKey:r,uploadId:e,key:a,parts:i}),confirmUpload:async({url:e})=>await tA.confirmUpload({accessKey:t,secretKey:r,url:e}),deleteFile:async({url:e})=>await tA.deleteFile({accessKey:t,secretKey:r,url:e}),listFiles:async e=>await tA.listFiles({accessKey:t,secretKey:r,...e})}}({accessKey:t,secretKey:r});return{init:async({ctx:e,router:t})=>({token:await i.getToken({ctx:e,router:t})}),getBaseUrl:()=>a,getFile:async({url:e})=>{let{uploadedAt:t,...r}=await i.getFile({url:e});return{uploadedAt:new Date(t),...r}},async requestUpload({bucketName:e,bucketType:t,fileInfo:r}){let a=5242880;if(r.size>10485760){let n=Math.ceil(r.size/a);n>1e3&&(n=1e3,a=Math.ceil(r.size/n));let s=await i.requestUpload({bucketName:e,bucketType:t,fileInfo:r,multipart:{parts:Array.from({length:n}).map((e,t)=>t+1)}}),o=s.multipart?{key:s.multipart.key,uploadId:s.multipart.uploadId,parts:s.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl})),partSize:a,totalParts:n}:void 0;if(o)return{accessUrl:s.accessUrl,thumbnailUrl:s.thumbnailUrl,multipart:o};if(s.signedUrl)return{accessUrl:s.accessUrl,uploadUrl:s.signedUrl,thumbnailUrl:s.thumbnailUrl};throw new tf({message:"Could not get upload url",code:"SERVER_ERROR"})}let n=await i.requestUpload({bucketName:e,bucketType:t,fileInfo:r});if(n.signedUrl)return{accessUrl:n.accessUrl,uploadUrl:n.signedUrl,thumbnailUrl:n.thumbnailUrl};throw new tf({message:"Could not get upload url",code:"SERVER_ERROR"})},requestUploadParts:async({multipart:e,path:t})=>{let r=await i.requestUploadParts({multipart:e,key:t});return{multipart:{uploadId:r.multipart.uploadId,parts:r.multipart.parts.map(e=>({partNumber:e.partNumber,uploadUrl:e.signedUrl}))}}},completeMultipartUpload:async({uploadId:e,key:t,parts:r})=>await i.completeMultipartUpload({uploadId:e,key:t,parts:r}),confirmUpload:async({url:e})=>await i.confirmUpload({url:e}),deleteFile:async({url:e})=>await i.deleteFile({url:e})}}()}=e,r=new tE(e.logLevel);return globalThis._EDGE_STORE_LOGGER=r,r.debug("Creating Edge Store Next handler (app adapter)"),async a=>{try{if(!("nextUrl"in a))throw new tf({message:"Error running the app adapter. Make sure you are importing the correct adapter in your router configuration",code:"SERVER_ERROR"});let r=a.nextUrl.pathname;if(tb(r,"/health"))return new Response("OK",{status:200});if(tb(r,"/init")){let r={};try{r="createContext"in e?await e.createContext({req:a}):{}}catch(e){throw new tf({message:"Error creating context",code:"CREATE_CONTEXT_ERROR",cause:e instanceof Error?e:void 0})}let{newCookies:i,token:n,baseUrl:s}=await aB({ctx:r,provider:t,router:e.router}),o=new Response(JSON.stringify({token:n,baseUrl:s}),{status:200,headers:{"Content-Type":"application/json"}});for(let e of i)o.headers.append("Set-Cookie",e);return o}if(tb(r,"/request-upload")){let r=await aJ({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}if(tb(r,"/request-upload-parts")){let r=await az({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(tb(r,"/complete-multipart-upload"))return await aF({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value}),new Response(null,{status:200});else if(tb(r,"/confirm-upload")){let r=await aG({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else if(tb(r,"/delete-file")){let r=await aV({provider:t,router:e.router,body:await a.json(),ctxToken:a.cookies.get("edgestore-ctx")?.value});return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json"}})}else{if(!tb(r,"/proxy-file"))return new Response(null,{status:404});let e=a.nextUrl.searchParams.get("url");if("string"!=typeof e)return new Response(null,{status:400});{let t=await fetch(e,{headers:{cookie:a.cookies.toString()??""}}),r=await t.arrayBuffer();return new Response(r,{status:t.status,headers:{"Content-Type":t.headers.get("Content-Type")??"application/octet-stream"}})}}}catch(e){if(e instanceof tf)return r[e.level](e.formattedMessage()),e.cause&&r[e.level](e.cause),new Response(JSON.stringify(e.formattedJson()),{status:th[e.code],headers:{"Content-Type":"application/json"}});return r.error(e),new Response(JSON.stringify(new tf({message:"Internal server error",code:"SERVER_ERROR"}).formattedJson()),{status:500,headers:{"Content-Type":"application/json"}})}}}({router:a0.router({publicFiles:a0.fileBucket()})}),a2=new f.AppRouteRouteModule({definition:{kind:m.x.APP_ROUTE,page:"/api/edgestore/[...edgestore]/route",pathname:"/api/edgestore/[...edgestore]",filename:"route",bundlePath:"app/api/edgestore/[...edgestore]/route"},resolvedPagePath:"C:\\Users\\albin\\OneDrive\\Desktop\\albints158\\client-app\\app\\api\\edgestore\\[...edgestore]\\route.js",nextConfigOutput:"",userland:h}),{requestAsyncStorage:a4,staticGenerationAsyncStorage:a6,serverHooks:a5}=a2,a8="/api/edgestore/[...edgestore]/route";function a3(){return(0,y.patchFetch)({serverHooks:a5,staticGenerationAsyncStorage:a6})}},43183:(e,t)=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var r={},a=(t||{}).decode||i,n=0;n<e.length;){var s=e.indexOf("=",n);if(-1===s)break;var o=e.indexOf(";",n);if(-1===o)o=e.length;else if(o<s){n=e.lastIndexOf(";",s-1)+1;continue}var d=e.slice(n,s).trim();if(void 0===r[d]){var c=e.slice(s+1,o).trim();34===c.charCodeAt(0)&&(c=c.slice(1,-1)),r[d]=function(e,t){try{return t(e)}catch(t){return e}}(c,a)}n=o+1}return r},t.serialize=function(e,t,i){var s=i||{},o=s.encode||n;if("function"!=typeof o)throw TypeError("option encode is invalid");if(!a.test(e))throw TypeError("argument name is invalid");var d=o(t);if(d&&!a.test(d))throw TypeError("argument val is invalid");var c=e+"="+d;if(null!=s.maxAge){var l=s.maxAge-0;if(isNaN(l)||!isFinite(l))throw TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(l)}if(s.domain){if(!a.test(s.domain))throw TypeError("option domain is invalid");c+="; Domain="+s.domain}if(s.path){if(!a.test(s.path))throw TypeError("option path is invalid");c+="; Path="+s.path}if(s.expires){var u=s.expires;if("[object Date]"!==r.call(u)&&!(u instanceof Date)||isNaN(u.valueOf()))throw TypeError("option expires is invalid");c+="; Expires="+u.toUTCString()}if(s.httpOnly&&(c+="; HttpOnly"),s.secure&&(c+="; Secure"),s.priority)switch("string"==typeof s.priority?s.priority.toLowerCase():s.priority){case"low":c+="; Priority=Low";break;case"medium":c+="; Priority=Medium";break;case"high":c+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(s.sameSite)switch("string"==typeof s.sameSite?s.sameSite.toLowerCase():s.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return c};var r=Object.prototype.toString,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function i(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}function n(e){return encodeURIComponent(e)}},49303:(e,t,r)=>{e.exports=r(30517)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(83965));module.exports=a})();
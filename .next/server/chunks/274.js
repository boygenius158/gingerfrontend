"use strict";exports.id=274,exports.ids=[274],exports.modules={25728:(e,s,l)=>{l.d(s,{Z:()=>r});let r=(0,l(3539).Ue)(e=>({isVedioCallActive:!1,startVideoCall:()=>e({isVedioCallActive:!0}),endVideoCall:()=>e({isVedioCallActive:!1})}))},14873:(e,s,l)=>{l.d(s,{Z:()=>j});var r=l(10326),t=l(21291),i=l(20239),a=l(77109),o=l(46226),n=l(17577),c=l(38492),d=l(99779),u=l(54173),m=l.n(u),x=l(46667);function h({isSeen:e,time:s}){let l=new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});return r.jsx("div",{className:"absolute bottom-0 right-0 mb-2 mr-2 p-2 bg-gray-800 text-white text-sm rounded shadow-lg",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("p",{children:["Read: ",e?"Yes":"No"]}),(0,r.jsxs)("p",{children:["Delivered: ",l]})]})})}var g=l(96070);function f({audioSrc:e}){let s=(0,n.useRef)(null),l=(0,n.useRef)(null),[t,i]=(0,n.useState)(!1),[a,o]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:" overflow-hidden",children:[r.jsx("div",{ref:s,children:t&&r.jsx("div",{children:"Loading..."})}),r.jsx("button",{onClick:()=>{l.current&&(a?l.current.pause():l.current.play(),o(!a))},children:a?"Pause":"Play"})]})}l(89969);var v=l(90434);function j({recipient:e}){let{edgestore:s}=(0,g.P)(),l=(0,t.s)(),[u,j]=(0,n.useState)(""),[p,b]=(0,n.useState)([]),[w,N]=(0,n.useState)(!1),[y,k]=(0,n.useState)(!1),{data:C}=(0,a.useSession)(),[S,Z]=(0,n.useState)(""),[R,L]=(0,n.useState)(),[M,D]=(0,n.useState)(!1),[A,B]=(0,n.useState)(null),[V,z]=(0,n.useState)(!1),[I,P]=(0,n.useState)(0),[U,E]=(0,n.useState)(!1),[H,F]=(0,n.useState)(null),_=(0,n.useRef)(null);(0,n.useRef)(null);let O=(0,n.useRef)(null),T=(0,n.useRef)([]),W=async()=>{E(!0),z(!0);let e=await navigator.mediaDevices.getUserMedia({audio:!0});O.current=new MediaRecorder(e),O.current.ondataavailable=e=>{T.current.push(e.data)},O.current.start()},$=async r=>{console.log(r),r.preventDefault(),E(!1),P(0),z(!1),O.current.stop(),O.current.onstop=async()=>{let r=new Blob(T.current,{type:"audio/webm"});if(F(r),console.log("Blob size:",r.size),console.log("Blob:",r),T.current=[],r){console.log(r);let t=new FormData;t.append("file",r,"audio.webm"),console.log("FormData to upload:",t);try{let r=await s.publicFiles.upload({file:t.get("file"),onProgressChange:e=>{console.log("Upload progress:",e)}});console.log("Upload response:",r),l||console.log("socket not exist"),l.emit("audio-chat",{recipientEmail:e.email,senderEmail:C?.user?.email,message:r.url,type:"audio"})}catch(e){console.error("Upload error:",e)}}}},J=(0,n.useRef)();async function K(){if(R){let r=await s.publicFiles.upload({file:R,onProgressChange:e=>{console.log(e)}});C&&await i.Z.post("/api/user/sendImageInChat",{url:r.url,userId:C?.id}),response&&(L(null),Z(null),k(!1),l.emit("ImageMessage",{recipientEmail:e.email,senderEmail:C?.user?.email,message:r.url,type:"image"}))}}async function Y(){console.log("yes")}return console.log(S),console.log(C),console.log(e),(0,n.useCallback)(async()=>{if(C&&e?._id)try{console.log("hi");let s=await i.Z.post("/api/user/fetchHistoricalData",{senderId:C.id,receiverId:e._id});s&&(console.log("response was received",s.data.messages),b(s.data.messages))}catch(e){console.error("Error fetching historical data:",e)}},[C,e]),(0,n.useCallback)(async()=>{if(C)try{await i.Z.post("/api/user/updateReadStatus",{sender:C?.id,recipient:e?._id})}catch(e){console.error("Error updating read status:",e)}},[C,e]),(console.log(p),e)?(0,r.jsxs)("div",{className:"lg:mt-8 bg-gray-50",children:[r.jsx("div",{className:"",children:(0,r.jsxs)("div",{className:"h-16 bg-white border rounded flex justify-between ",children:[(0,r.jsxs)("div",{className:"flex justify-center items-center",children:[r.jsx("div",{className:"p-4",children:r.jsx(o.default,{src:e.profilePicture,alt:e.username,height:40,width:40,className:"rounded-full object-cover h-[40px] w-[40px]"})}),(0,r.jsxs)("div",{children:[r.jsx("div",{children:e.username}),r.jsx("div",{children:w&&r.jsx("div",{children:r.jsx("span",{className:"text-green-500 font-bold cursor-pointer","aria-live":"polite","aria-label":"User is online",children:"Online"})})})]})]}),(0,r.jsxs)("div",{className:"flex gap-4  ",children:[r.jsx("div",{className:"flex items-center justify-center"}),r.jsx("div",{className:"flex items-center justify-center cursor-pointer",children:r.jsx("span",{onClick:function(){console.log("call notification"),l.emit("call_notification",e.email)},className:"",children:r.jsx(v.default,{href:"/u/videocall",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})})})})}),r.jsx("div",{className:"flex items-center justify-center mr-3",children:r.jsx(c.Dxw,{className:"h-5 cursor-pointer"})})]})]})}),r.jsx("div",{className:"h-96 overflow-y-scroll border p-4 space-y-2",onScroll:function(e){let{scrollTop:s,scrollHeight:l,clientHeight:r}=e.target;console.log(s,l,r),l-s<=r+1?D(!0):D(!1)},children:p.map((e,s)=>{console.log("Message sender:",e),console.log("Session ID:",C?.id);let l=e.sender===C?.id;return(0,r.jsxs)("div",{className:`flex ${l?"justify-end":"justify-start"}`,children:[r.jsx("div",{onMouseEnter:()=>{B(s)},onMouseLeave:()=>void B(null),className:`inline-block cursor-pointer p-2 max-w-xs ${l?"bg-blue-500 text-white rounded-tl-2xl rounded-bl-2xl rounded-tr-md":"bg-gray-200 text-black rounded-tr-2xl rounded-br-2xl rounded-tl-md"}`,children:"image"===e.type?r.jsx(o.default,{src:e.message,height:250,width:250,alt:"User uploaded content",className:"max-w-full rounded"}):"audio"===e.type?r.jsx(r.Fragment,{children:r.jsx(f,{audioSrc:e.message,audioMessage:V})}):r.jsx("span",{children:e.message})}),A===s&&r.jsx("div",{className:"absolute bottom-0 right-0 mb-2 mr-2",children:r.jsx(h,{isSeen:e.isRead,time:e.timestamp})})]},s)})}),!V&&r.jsx("form",{action:"",onSubmit:function(s){s.preventDefault(),console.log(u),u.trim()&&l.emit("message",{recipientEmail:e.email,senderEmail:C?.user?.email,message:u,type:"text"}),j(""),console.log(u)},children:(0,r.jsxs)("div",{className:"bg-white p-3 border-t flex items-center space-x-3",children:[r.jsx("div",{onClick:W,className:"inline-flex items-center justify-center w-12 h-12 bg-gray-200 border border-gray-300 rounded-lg cursor-pointer transition-colors duration-300 hover:bg-gray-300 hover:border-gray-400",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})})}),r.jsx("div",{onClick:()=>k(!0),className:"inline-flex items-center justify-center w-12 h-12 bg-gray-200 border border-gray-300 rounded-lg cursor-pointer transition-colors duration-300 hover:bg-gray-300 hover:border-gray-400",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 text-gray-700",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),r.jsx("input",{value:u,onChange:e=>j(e.target.value),type:"text",placeholder:"Type a message...",className:"flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"}),r.jsx("button",{type:"submit",className:"bg-blue-500 p-2 rounded-full text-white hover:bg-blue-600 focus:outline-none",children:r.jsx(c.ip9,{className:"h-5 w-5 transform rotate-45"})})]})}),V&&(0,r.jsxs)("div",{className:"bg-white p-3 border-t flex items-center space-x-3",children:[(0,r.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,r.jsxs)("div",{children:[I," seconds"]}),r.jsx("button",{className:"text-red-800",onClick:()=>{z(!1),P(0),E(!1),T.current=[]},children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})]}),r.jsx("div",{className:"w-full",ref:_}),r.jsx("form",{action:"",onSubmit:Y,children:r.jsx("div",{className:"flex",children:r.jsx("button",{onClick:$,className:"bg-red-500 text-white p-2 rounded-lg hover:animate-bounce",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})})})})})]}),y&&r.jsx("form",{action:"",onSubmit:function(e){console.log(";;;"),e.preventDefault(),console.log("handle media sent")},children:r.jsx(m(),{onClick:()=>void(k(!1),L(null),Z(""),console.log("Modal closed. Image file URL:",S,"File:",R),J.current&&(J.current.value="")),isOpen:y,className:"fixed inset-0 flex items-center justify-center p-4",overlayClassName:"fixed inset-0 bg-black bg-opacity-50",ariaHideApp:!1,children:(0,r.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 w-full max-w-lg flex flex-col items-center",children:[r.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Send Image"}),S?r.jsx("div",{className:"grid grid-cols-2 gap-4",children:r.jsx(o.default,{onClick:()=>{Z(),L()},src:S,alt:"selected file ",width:150,height:150,className:"cursor-pointer"})}):r.jsx(c._HF,{onClick:()=>J.current.click(),className:"text-5xl text-gray-400 cursor-pointer"}),r.jsx("input",{hidden:!0,ref:J,type:"file",name:"file",accept:"image/*",multiple:!0,onChange:function(e){console.log("add");let s=e.target.files[0];L(s),Z(URL.createObjectURL(s))}}),r.jsx("button",{type:"submit",onClick:K,disabled:!R,className:"w-full bg-red-600 text-white p-2 shadow-md rounded-lg hover:brightness-105 disabled:bg-gray-200 disabled:cursor-not-allowed disabled:hover:brightness-100",children:"Send Image"}),r.jsx(x.oHP,{className:"cursor-pointer absolute top-4 right-4 hover:text-red-600 transition duration-300",onClick:()=>k(!1)})]})})})]}):(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"lg:mt-8 h-16 bg-white border rounded flex justify-between ",children:[r.jsx("div",{className:"flex justify-center items-center",children:r.jsx("div",{children:e.username})}),(0,r.jsxs)("div",{className:"flex gap-4  ",children:[r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})})}),r.jsx("div",{className:"flex items-center justify-center"}),r.jsx("div",{className:"flex items-center justify-center mr-3",children:r.jsx(c.Dxw,{className:"h-5 cursor-pointer"})})]})]}),r.jsx("div",{className:" h-96 bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"",children:[r.jsx("h1",{className:"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl ",children:"Start Messaging!"}),r.jsx("div",{className:"",children:r.jsx(d.J5,{src:"https://lottie.host/ad46920e-be46-4429-beb6-6158cb2bba67/uvrRhaKmT2.json",className:"player",loop:!0,autoplay:!0,style:{height:"300px",width:"300px"}})})]})})]})}},57648:(e,s,l)=>{l.d(s,{Z:()=>c});var r=l(10326),t=l(21291),i=l(25728),a=l(77109),o=l(46226),n=l(17577);function c({userSelected:e,list:s}){let{data:l}=(0,a.useSession)(),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(),x=(0,t.s)();console.log(s);let h=(0,i.Z)(e=>e.startVideoCall);return console.log((0,i.Z)(e=>e.isVedioCallActive)),console.log(l),(0,r.jsxs)("div",{className:" bg-gray-100 p-4 mt-8 rounded-lg shadow-md",children:[(0,r.jsxs)("div",{className:"text-center  font-semibold mb-4",children:[" ",r.jsx("h1",{className:"p-4  text-2xl  font-extrabold  tracking-tight  flex justify-center items-center ",children:"Chat"})]}),r.jsx("div",{className:"space-y-4",children:s.map(s=>r.jsx("div",{children:(0,r.jsxs)("div",{className:"flex bg-white",children:[(0,r.jsxs)("div",{className:"flex flex-grow items-center space-x-4 p-2 rounded-lg shadow-sm cursor-pointer",onClick:()=>e(s),children:[r.jsx(o.default,{src:s.profilePicture,alt:s.username,height:40,width:40,className:"rounded-full object-cover h-[40px] w-[40px]"}),r.jsx("p",{className:"text-md font-medium",children:s.username})]}),r.jsx("div",{className:" flex items-center justify-end mr-8 cursor-pointer",onClick:()=>{h(),e(s),console.log("call clicked",s),x.emit("call",s.email,l.user.email)},children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})})})]})},s.id))})]})}l(54173)},24759:(e,s,l)=>{l.d(s,{Z:()=>d});var r=l(10326),t=l(21291);l(99779),l(46226);var i=l(17577),a=l(38492);l(54173),l(31190),l(29497);var o=l(8668),n=l(92216),c=l(25728);function d({setIncomingCallFunction:e,setCallFrom:s,user:l}){let d=(0,i.useRef)(null),u=(0,i.useRef)(null),[m,x]=(0,i.useState)(null),[h,g]=(0,i.useState)(!0),f=(0,t.s)();console.log(l);let{isVedioCallActive:v,startVideoCall:j,endVideoCall:p}=(0,c.Z)();return console.log(e),r.jsx("div",{children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"h-16 bg-white border rounded flex justify-between mt-8",children:[r.jsx("div",{className:"flex justify-center items-center",children:r.jsx("div",{children:l.username})}),(0,r.jsxs)("div",{className:"flex gap-4  ",children:[r.jsx("div",{className:"flex items-center justify-center",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:r.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})})}),r.jsx("div",{className:"flex items-center justify-center"}),r.jsx("div",{className:"flex items-center justify-center mr-3",children:r.jsx(a.Dxw,{className:"h-5 cursor-pointer"})})]})]}),(0,r.jsxs)("div",{className:"relative h-96 bg-gray-50 flex items-center justify-center",children:[r.jsx("video",{ref:u,className:"w-full h-full object-cover",autoPlay:!0,muted:!0}),r.jsx("div",{className:"absolute bottom-4 right-4 w-32 h-24 border border-gray-300 rounded-md shadow-lg",children:r.jsx("video",{ref:d,className:"w-full h-full object-cover rounded-md",autoPlay:!0,muted:!0})})]}),r.jsx("div",{className:" h-20 flex justify-center items-center gap-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4 cursor-pointer",children:[r.jsx("div",{onClick:()=>{console.log("handlecall"),m.createOffer({offerToReceiveVideo:1}).then(e=>m.setLocalDescription(e)).then(()=>f.emit("offer",m.localDescription,l.email)).catch(e=>console.error("error creating offer",e))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-300 transform hover:scale-110",children:r.jsx(n.Z,{})}),r.jsx("div",{onClick:p,className:"p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors duration-300 transform hover:scale-110",children:r.jsx(o.Z,{})})]})})]})})}},57481:(e,s,l)=>{l.r(s),l.d(s,{default:()=>t});var r=l(66621);let t=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};
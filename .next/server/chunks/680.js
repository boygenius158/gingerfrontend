"use strict";exports.id=680,exports.ids=[680],exports.modules={4680:(e,s,t)=>{t.d(s,{Z:()=>M});var a=t(10326),l=t(17577),r=t(46226),i=t(38492),o=t(21291);let{create:n}=t(54884);n(e=>({feedPosts:[],setFeedPosts:s=>e({feedPosts:s})}));var d=t(20239),c=t(77109),x=t(74964),h=t(76812);function m({post:e}){return console.log(e),a.jsx("div",{className:"",children:(0,a.jsxs)(x.fC,{children:[a.jsx(x.xz,{asChild:!0,children:a.jsx("button",{className:"flex items-center bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md",children:a.jsx(h.eA8,{className:"w-6 h-6","aria-hidden":"true"})})}),a.jsx(x.VY,{className:"w-[360px] p-4 bg-white shadow-lg rounded-md",children:(0,a.jsxs)("div",{className:"grid grid-cols-[130px_1fr] gap-4",children:[a.jsx("div",{className:"pr-2",children:a.jsx(r.default,{src:e.imageUrl[0],width:50,height:50,alt:"Minimalistic 3D rendering wallpaper",className:"rounded-md"})}),(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Share this image"}),a.jsx("p",{className:"text-gray-600 mb-4"}),(0,a.jsxs)("div",{className:"flex flex-col items-start gap-y-2",children:[a.jsx(x.x8,{asChild:!0,children:(0,a.jsxs)("button",{onClick:function(){let s=e._id,t=`${process.env.NEXTAUTH_URL}/post/${s}`;navigator.clipboard.writeText(t).then(()=>{console.log("Link copied to clipboard!")}).catch(e=>{console.error("Failed to copy the link: ",e)})},className:"flex items-center bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md",children:[a.jsx(h.DrZ,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Copy link"]})}),a.jsx(x.x8,{asChild:!0,children:(0,a.jsxs)("button",{onClick:function(){console.log("handle share click",e._id);let s=e._id,t=`Check out this post: https://localhost:3000/post/${s}`,a=`http://wa.me/?text=${encodeURIComponent(t)}`;window.open(a,"_blank")},className:"flex items-center bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-md",children:[a.jsx(h.eA8,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Whatsapp"]})})]})]})]})})]})})}function u({post:e,isSaved:s}){let t=(0,o.s)(),[r,n]=(0,l.useState)(!1),[x,h]=(0,l.useState)(s),[u,f]=(0,l.useState)(e.likeCount),{data:p,status:j}=(0,c.useSession)();async function g(){try{await d.Z.post("/api/user/likepost",{postId:e._id,originalUser:p.id}),console.log("clicked"),n(e=>!e),f(e=>e+(r?-1:1)),console.log(p?.id,"sessionid"),t.emit("notification",{user:e.userId,type:r?"like":"unlike",originalUser:p?.id,postId:e._id})}catch(e){console.error("Error liking post:",e)}}async function N(){h(e=>!e),console.log("save post"),await d.Z.post("/api/user/savePost",{postId:e._id,userId:p.id})}return console.log(p),a.jsx("div",{children:(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-100 px-4 pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-center gap-2",children:[r?a.jsx(i.dOX,{onClick:g,className:"text-red-500 cursor-pointer text-3xl hover:scale-125 transition-transform duration-200 ease-out"}):a.jsx(i.wkn,{onClick:g,className:"cursor-pointer text-3xl hover:scale-125 transition-transform duration-200 ease-out"}),u.length>0&&(0,a.jsxs)("p",{className:"text-gray-500",children:[u," ",1===u?"like":"likes"]}),u," ",1===u?"like":"likes"]}),(0,a.jsxs)("div",{className:"flex gap-4 cursor-pointer",children:[a.jsx("div",{className:"flex items-center bg-gray-200 px-4 py-2 hover:bg-gray-300 rounded-md ",children:x?a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",className:"w-6 h-6 text-gray-700",children:a.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H18A2.25 2.25 0 0 1 20.25 6v12A2.25 2.25 0 0 1 18 20.25H6A2.25 2.25 0 0 1 3.75 18V6A2.25 2.25 0 0 1 6 3.75h1.5m9 0h-9",onClick:N})}):a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",className:"w-6 h-6 text-gray-700",onClick:N,children:a.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"})})}),a.jsx("div",{children:a.jsx("div",{children:a.jsx(m,{post:e})})})]})]})})}t(63139);var f=t(54173),p=t.n(f),j=t(46667),g=t(31190);t(45996);var N=t(40314);function v({data:e}){return console.log(e),a.jsx("div",{children:a.jsx("div",{children:(0,a.jsxs)(N.lr,{className:"relative w-full h-full",children:[a.jsx(N.KI,{className:"flex w-full h-full items-center  ",children:e.imageUrl.length>0&&e.imageUrl.map((e,s)=>a.jsx(N.d$,{className:"shrink-0 w-full h-full flex items-center justify-center",children:a.jsx(r.default,{src:e,alt:s,height:250,width:250})},s))}),a.jsx(N.am,{className:"absolute left-2 top-1/2 transform -translate-y-1/2"}),a.jsx(N.Pz,{className:"absolute right-2 top-1/2 transform -translate-y-1/2"})]})})})}var y=t(80440),w=t(46084),b=t(18729);let k=y.fC,C=y.xz,S=y.h_,D=l.forwardRef(({className:e,...s},t)=>a.jsx(y.aV,{className:(0,w.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:t}));D.displayName=y.aV.displayName;let A=l.forwardRef(({className:e,...s},t)=>(0,a.jsxs)(S,{children:[a.jsx(D,{}),a.jsx(y.VY,{ref:t,className:(0,w.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));A.displayName=y.VY.displayName;let P=({className:e,...s})=>a.jsx("div",{className:(0,w.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...s});P.displayName="AlertDialogHeader";let R=({className:e,...s})=>a.jsx("div",{className:(0,w.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});R.displayName="AlertDialogFooter";let U=l.forwardRef(({className:e,...s},t)=>a.jsx(y.Dx,{ref:t,className:(0,w.cn)("text-lg font-semibold",e),...s}));U.displayName=y.Dx.displayName;let _=l.forwardRef(({className:e,...s},t)=>a.jsx(y.dk,{ref:t,className:(0,w.cn)("text-sm text-muted-foreground",e),...s}));_.displayName=y.dk.displayName;let $=l.forwardRef(({className:e,...s},t)=>a.jsx(y.aU,{ref:t,className:(0,w.cn)((0,b.d)(),e),...s}));$.displayName=y.aU.displayName;let I=l.forwardRef(({className:e,...s},t)=>a.jsx(y.$j,{ref:t,className:(0,w.cn)((0,b.d)({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));function z({post:e,isSaved:s}){let t=()=>{g.Am.success("Post Has Been Reported!",{position:a.jsx("toast",{className:"POSITION TOP_CENTER"}),autoClose:5e3})};console.log(e);let[o,n]=(0,l.useState)(!1),[x,h]=(0,l.useState)(!1),{data:m,status:f}=(0,c.useSession)();async function N(s){console.log("handle report s"),s.preventDefault();let a=await d.Z.post("/api/user/reportPost",{postId:e._id,victimUser:m.id});console.log(a),a&&(n(!1),h(!1),t())}return console.log(m),(0,a.jsxs)("div",{className:"bg-white my-7 border-2  rounded-md",children:[o&&a.jsx(p(),{isOpen:o,onRequestClose:()=>n(!1),className:"fixed inset-0 flex items-center justify-center p-4",overlayClassName:"fixed inset-0 bg-black bg-opacity-50",ariaHideApp:!1,children:(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 w-full max-w-lg flex flex-col items-center",children:[a.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Action"}),(0,a.jsxs)(k,{children:[a.jsx(C,{asChild:!0,children:a.jsx(b.z,{variant:"outline",children:"Report Post"})}),(0,a.jsxs)(A,{children:[(0,a.jsxs)(P,{children:[a.jsx(U,{children:"Are you absolutely sure?"}),a.jsx(_,{children:"This action cannot be undone. Are you sure you want to report this post?"})]}),(0,a.jsxs)(R,{children:[a.jsx(I,{children:"Cancel"}),a.jsx($,{children:a.jsx("span",{onClick:N,children:"Yes"})})]})]})]}),a.jsx(j.oHP,{className:"cursor-pointer absolute top-4 right-4 hover:text-red-600 transition duration-300",onClick:()=>n(!1)})]})}),(0,a.jsxs)("div",{className:"flex items-center p-5 border-b border-gray-100 gap-x-1",children:[a.jsx("div",{className:"relative w-12 h-12",children:a.jsx(r.default,{src:e?.userDetails?.profilePicture,alt:"hell world",layout:"fill",className:"rounded-full object-cover border p-1"})}),a.jsx("div",{className:"flex-1",children:a.jsx("p",{className:"font-bold",children:e.userDetails.username})}),a.jsx("div",{className:"flex justify-end items-center",children:a.jsx(i.Dxw,{className:"h-5 cursor-pointer",onClick:()=>n(e=>!e)})})]}),a.jsx(v,{data:e}),a.jsx(u,{post:e,isSaved:s}),(0,a.jsxs)("p",{className:"p-5 truncate flex",children:[a.jsx("span",{className:"font-bold mr-2",children:e.userDetails.username}),a.jsx("div",{children:"*"===e.caption?a.jsx("p",{}):a.jsx("p",{children:e.caption})})]})]})}I.displayName=y.$j.displayName;var L=t(34462),V=t(32316);function Z({story:e}){let[s,t]=(0,l.useState)(!1),i=()=>t(!1);console.log(e);let[o,n]=(0,l.useState)(13),d=e=>e.length>6?`${e.slice(0,6)}...`:e;return(0,a.jsxs)("div",{className:" ",children:[(0,a.jsxs)("div",{className:"w-16 h-16 rounded-full bg-gray-300 overflow-hidden cursor-pointer",onClick:()=>t(!0),children:[a.jsx(r.default,{className:"rounded-full",src:e.userDetails.profilePicture,alt:e.userDetails.username,height:64,width:64}),a.jsx("h1",{children:d(e.userDetails.username)})]}),(0,a.jsxs)("h1",{className:"italic text-gray-800",children:["        ",a.jsx("h1",{children:d(e.userDetails.username)})]}),a.jsx(p(),{isOpen:s,onRequestClose:i,contentLabel:"Story Modal",className:"fixed inset-0 flex items-center justify-center  p-4 mt-32 ",overlayClassName:"fixed inset-0 bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-lg",children:[(0,a.jsxs)("div",{className:"mb-2",children:[a.jsx(V.E,{value:o,className:""})," "]}),a.jsx("button",{onClick:i,className:"absolute top-2 right-2 text-gray-600 hover:text-gray-900",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})}),a.jsx("div",{className:"flex items-center justify-center",children:a.jsx(r.default,{className:"rounded-lg",src:e.imageUrl,alt:e.userDetails.username,height:300,width:300})}),a.jsx("p",{className:"mt-4 text-center text-lg font-semibold",children:e.userDetails.username})]})})]})}let E=(0,t(3539).Ue)(e=>({stories:[],setStories:s=>e({stories:s})}));function F(){let{data:e,status:s}=(0,c.useSession)(),{stories:t,setStories:r}=E(),[i,o]=(0,l.useState)(!0),[n,x]=(0,l.useState)(null);return((0,l.useCallback)(async()=>{if(e?.id)try{o(!0);let s=await d.Z.post("/api/user/fetchStories",{userId:e.id});r(s.data.stories)}catch(e){console.error("Error fetching stories:",e),x("Failed to fetch stories")}finally{o(!1)}},[e?.id,r]),i)?a.jsx("div",{children:"Loading..."}):n?a.jsx("div",{children:n}):a.jsx("div",{className:"bg-white z-10 mb-4 space-x-4 flex items-center p-6 w-screen lg:w-1/2 overflow-x-scroll hide-scrollbar",children:t.length>0?t.map((e,s)=>a.jsx(Z,{story:e},s)):a.jsx("div",{children:"No stories available"})})}var H=t(84246);function M(){let{data:e,status:s}=(0,c.useSession)(),[t,r]=(0,l.useState)([]),[i,o]=(0,l.useState)(!0),[n,x]=(0,l.useState)(0);(0,l.useCallback)(async e=>{try{let s=await d.Z.post("/api/user/fetchfeed",{email:e,offset:0,limit:2});console.log("response",s.data.feed),r(s.data.feed||[]),x(2)}catch(e){console.error("Failed to fetch posts",e)}},[2]);let h=async()=>{try{if("authenticated"===s&&e?.user?.email){let s=await d.Z.post("/api/user/fetchfeed",{email:e.user.email,offset:n,limit:2});console.log("response",s.data.feed),r(e=>[...e,...s.data.feed||[]]),x(e=>e+2),o(s.data.feed.length>0)}}catch(e){console.error("Failed to fetch more posts",e)}};return"loading"===s?a.jsx("div",{children:a.jsx(H.$j,{})}):"unauthenticated"===s?a.jsx("div",{children:"Please log in to view posts."}):(0,a.jsxs)("div",{className:"relative ",children:[a.jsx("h1",{className:" text-4xl font-extrabold  tracking-tight lg:text-5xl flex justify-center items-center mt-4 ",children:"Feed"}),(0,a.jsxs)("div",{className:"",children:[a.jsx(F,{}),a.jsx(L.Z,{dataLength:t.length,next:h,hasMore:i,loader:a.jsx("div",{children:a.jsx(H.$j,{loading:!0})}),children:a.jsx("div",{className:"container",children:t.length>0?t.map(e=>a.jsx(z,{post:e,isSaved:e.isSaved},e._id)):a.jsx("div",{children:"No posts available."})})})]})]})}},32316:(e,s,t)=>{t.d(s,{E:()=>o});var a=t(10326),l=t(17577),r=t(87273),i=t(46084);let o=l.forwardRef(({className:e,value:s,...t},l)=>a.jsx(r.fC,{ref:l,className:(0,i.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:a.jsx(r.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));o.displayName=r.fC.displayName}};
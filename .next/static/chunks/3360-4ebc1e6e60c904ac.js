"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3360],{34203:function(e,s,r){r.d(s,{SocketProvider:function(){return a},s:function(){return c}});var t=r(57437),l=r(2265),n=r(30998),i=r(34999);let o=(0,l.createContext)(null),a=e=>{var s;let{children:r}=e,{data:a}=(0,n.useSession)(),c=(0,l.useRef)(null);return(0,l.useEffect)(()=>{var e;return(null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.email)&&!c.current&&(c.current=(0,i.ZP)("http://localhost:5000"),c.current.emit("register",a.user.email)),()=>{c.current&&c.current.disconnect()}},[null==a?void 0:null===(s=a.user)||void 0===s?void 0:s.email]),(0,t.jsx)(o.Provider,{value:c.current,children:r})},c=()=>(0,l.useContext)(o)},73314:function(e,s,r){r.d(s,{EdgeStoreProvider:function(){return t},P:function(){return l}});let{EdgeStoreProvider:t,useEdgeStore:l}=(0,r(37811).q)()},47251:function(e,s,r){let t=(0,r(13e3).Ue)(e=>({isVedioCallActive:!1,startVideoCall:()=>e({isVedioCallActive:!0}),endVideoCall:()=>e({isVedioCallActive:!1})}));s.Z=t},6577:function(e,s,r){var t=r(38472),l=r(30998);let n=t.Z.create({baseURL:"http://localhost:5000",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(async e=>{let s=await (0,l.getSession)();return console.log("hi",s),s&&s.token&&(console.log(s),e.headers.Authorization="Bearer ".concat(s.token)),e},e=>Promise.reject(e)),s.Z=n},65090:function(e,s,r){r.d(s,{Z:function(){return j}});var t=r(57437),l=r(34203),n=r(6577),i=r(30998),o=r(66648),a=r(2265),c=r(54008),d=r(92914),u=r(7583),m=r.n(u),h=r(49690);function x(e){let{isSeen:s,time:r}=e,l=new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0});return(0,t.jsx)("div",{className:"absolute bottom-0 right-0 mb-2 mr-2 p-2 bg-gray-800 text-white text-sm rounded shadow-lg",children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("p",{children:["Read: ",s?"Yes":"No"]}),(0,t.jsxs)("p",{children:["Delivered: ",l]})]})})}var g=r(73314),f=r(58546);function v(e){let{audioSrc:s}=e,r=(0,a.useRef)(null),l=(0,a.useRef)(null),[n,i]=(0,a.useState)(!1),[o,c]=(0,a.useState)(!1);return(0,a.useEffect)(()=>(l.current&&l.current.destroy(),l.current=f.Z.create({container:r.current,waveColor:"#ddd",progressColor:"#3b82f6",height:50,width:450,barWidth:2,barHeight:1}),i(!0),l.current.load(s).then(()=>{i(!1)}).catch(e=>{console.error("WaveSurfer error:",e),i(!1)}),()=>{l.current&&l.current.destroy()}),[s]),(0,t.jsxs)("div",{className:" overflow-hidden",children:[(0,t.jsx)("div",{ref:r,children:n&&(0,t.jsx)("div",{children:"Loading..."})}),(0,t.jsx)("button",{onClick:()=>{l.current&&(o?l.current.pause():l.current.play(),c(!o))},children:o?"Pause":"Play"})]})}var p=r(87138);function j(e){var s;let{recipient:r}=e,{edgestore:u}=(0,g.P)(),f=(0,l.s)(),[j,w]=(0,a.useState)(""),[b,N]=(0,a.useState)([]),[y,k]=(0,a.useState)(!1),[C,S]=(0,a.useState)(!1),{data:R}=(0,i.useSession)(),[E,Z]=(0,a.useState)(""),[D,L]=(0,a.useState)(),[M,P]=(0,a.useState)(!1),[I,A]=(0,a.useState)(null),[B,U]=(0,a.useState)(!1),[T,V]=(0,a.useState)(0),[_,z]=(0,a.useState)(!1),[H,F]=(0,a.useState)(null),O=(0,a.useRef)(null);(0,a.useRef)(null);let W=(0,a.useRef)(null),q=(0,a.useRef)([]);(0,a.useEffect)(()=>{let e;return _?e=setInterval(()=>{V(e=>e+1)},1e3):clearInterval(e),()=>clearInterval(e)},[_]);let J=async()=>{z(!0),U(!0);let e=await navigator.mediaDevices.getUserMedia({audio:!0});W.current=new MediaRecorder(e),W.current.ondataavailable=e=>{q.current.push(e.data)},W.current.start()},K=async e=>{console.log(e),e.preventDefault(),z(!1),V(0),U(!1),W.current.stop(),W.current.onstop=async()=>{let e=new Blob(q.current,{type:"audio/webm"});if(F(e),console.log("Blob size:",e.size),console.log("Blob:",e),q.current=[],e){console.log(e);let t=new FormData;t.append("file",e,"audio.webm"),console.log("FormData to upload:",t);try{var s;let e=await u.publicFiles.upload({file:t.get("file"),onProgressChange:e=>{console.log("Upload progress:",e)}});console.log("Upload response:",e),f||console.log("socket not exist"),f.emit("audio-chat",{recipientEmail:r.email,senderEmail:null==R?void 0:null===(s=R.user)||void 0===s?void 0:s.email,message:e.url,type:"audio"})}catch(e){console.error("Upload error:",e)}}}};(0,a.useEffect)(()=>{if(console.log(b),f)return f.on("audio-chat-return",e=>{console.log(e),console.log(b),N(s=>[...s,e])}),()=>{f.off("audio-chat-return")}},[f,b]);let Y=(0,a.useRef)();async function G(){if(D){let s=await u.publicFiles.upload({file:D,onProgressChange:e=>{console.log(e)}});if(R&&await n.Z.post("/api/user/sendImageInChat",{url:s.url,userId:null==R?void 0:R.id}),response){var e;L(null),Z(null),S(!1),f.emit("ImageMessage",{recipientEmail:r.email,senderEmail:null==R?void 0:null===(e=R.user)||void 0===e?void 0:e.email,message:s.url,type:"image"})}}}console.log(E),console.log(R),console.log(r);let Q=(0,a.useCallback)(async()=>{if(R&&(null==r?void 0:r._id))try{console.log("hi");let e=await n.Z.post("/api/user/fetchHistoricalData",{senderId:R.id,receiverId:r._id});e&&(console.log("response was received",e.data.messages),N(e.data.messages))}catch(e){console.error("Error fetching historical data:",e)}},[R,r]);(0,a.useEffect)(()=>{Q()},[Q]);let X=(0,a.useCallback)(async()=>{if(R)try{await n.Z.post("/api/user/updateReadStatus",{sender:null==R?void 0:R.id,recipient:null==r?void 0:r._id})}catch(e){console.error("Error updating read status:",e)}},[R,r]);async function $(){console.log("yes")}return(0,a.useEffect)(()=>{M&&X()},[M,X]),(0,a.useEffect)(()=>{f&&f.on("statusOnline",e=>{console.log(e),k(e)})},[f]),(0,a.useEffect)(()=>{var e;f&&(null==R?void 0:null===(e=R.user)||void 0===e?void 0:e.email)&&f.emit("onlineStatus",null==r?void 0:r.email,R.user.email)},[f,r,null==R?void 0:null===(s=R.user)||void 0===s?void 0:s.email]),(0,a.useEffect)(()=>{var e;if(!f){console.log("socket is missing");return}return f.emit("register",null==R?void 0:null===(e=R.user)||void 0===e?void 0:e.email),f.on("receive_message",e=>{console.log(e),N(s=>[...s,e])}),()=>{f.off("receive_message")}},[f,R]),(console.log(b),r)?(0,t.jsxs)("div",{className:"lg:mt-8 bg-gray-50",children:[(0,t.jsx)("div",{className:"",children:(0,t.jsxs)("div",{className:"h-16 bg-white border rounded flex justify-between ",children:[(0,t.jsxs)("div",{className:"flex justify-center items-center",children:[(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)(o.default,{src:r.profilePicture,alt:r.username,height:40,width:40,className:"rounded-full object-cover h-[40px] w-[40px]"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{children:r.username}),(0,t.jsx)("div",{children:y&&(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:"text-green-500 font-bold cursor-pointer","aria-live":"polite","aria-label":"User is online",children:"Online"})})})]})]}),(0,t.jsxs)("div",{className:"flex gap-4  ",children:[(0,t.jsx)("div",{className:"flex items-center justify-center"}),(0,t.jsx)("div",{className:"flex items-center justify-center cursor-pointer",children:(0,t.jsx)("span",{onClick:function(){console.log("call notification"),f.emit("call_notification",r.email)},className:"",children:(0,t.jsx)(p.default,{href:"/u/videocall",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})})})})}),(0,t.jsx)("div",{className:"flex items-center justify-center mr-3",children:(0,t.jsx)(c.Dxw,{className:"h-5 cursor-pointer"})})]})]})}),(0,t.jsx)("div",{className:"h-96 overflow-y-scroll border p-4 space-y-2",onScroll:function(e){let{scrollTop:s,scrollHeight:r,clientHeight:t}=e.target;console.log(s,r,t),r-s<=t+1?P(!0):P(!1)},children:b.map((e,s)=>{console.log("Message sender:",e),console.log("Session ID:",null==R?void 0:R.id);let r=e.sender===(null==R?void 0:R.id);return(0,t.jsxs)("div",{className:"flex ".concat(r?"justify-end":"justify-start"),children:[(0,t.jsx)("div",{onMouseEnter:()=>{A(s)},onMouseLeave:()=>void A(null),className:"inline-block cursor-pointer p-2 max-w-xs ".concat(r?"bg-blue-500 text-white rounded-tl-2xl rounded-bl-2xl rounded-tr-md":"bg-gray-200 text-black rounded-tr-2xl rounded-br-2xl rounded-tl-md"),children:"image"===e.type?(0,t.jsx)(o.default,{src:e.message,height:250,width:250,alt:"User uploaded content",className:"max-w-full rounded"}):"audio"===e.type?(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(v,{audioSrc:e.message,audioMessage:B})}):(0,t.jsx)("span",{children:e.message})}),I===s&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 mb-2 mr-2",children:(0,t.jsx)(x,{isSeen:e.isRead,time:e.timestamp})})]},s)})}),!B&&(0,t.jsx)("form",{action:"",onSubmit:function(e){if(e.preventDefault(),console.log(j),j.trim()){var s;f.emit("message",{recipientEmail:r.email,senderEmail:null==R?void 0:null===(s=R.user)||void 0===s?void 0:s.email,message:j,type:"text"})}w(""),console.log(j)},children:(0,t.jsxs)("div",{className:"bg-white p-3 border-t flex items-center space-x-3",children:[(0,t.jsx)("div",{onClick:J,className:"inline-flex items-center justify-center w-12 h-12 bg-gray-200 border border-gray-300 rounded-lg cursor-pointer transition-colors duration-300 hover:bg-gray-300 hover:border-gray-400",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})})}),(0,t.jsx)("div",{onClick:()=>S(!0),className:"inline-flex items-center justify-center w-12 h-12 bg-gray-200 border border-gray-300 rounded-lg cursor-pointer transition-colors duration-300 hover:bg-gray-300 hover:border-gray-400",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"w-6 h-6 text-gray-700",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"})})}),(0,t.jsx)("input",{value:j,onChange:e=>w(e.target.value),type:"text",placeholder:"Type a message...",className:"flex-1 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"}),(0,t.jsx)("button",{type:"submit",className:"bg-blue-500 p-2 rounded-full text-white hover:bg-blue-600 focus:outline-none",children:(0,t.jsx)(c.ip9,{className:"h-5 w-5 transform rotate-45"})})]})}),B&&(0,t.jsxs)("div",{className:"bg-white p-3 border-t flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsxs)("div",{children:[T," seconds"]}),(0,t.jsx)("button",{className:"text-red-800",onClick:()=>{U(!1),V(0),z(!1),q.current=[]},children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})})})]}),(0,t.jsx)("div",{className:"w-full",ref:O}),(0,t.jsx)("form",{action:"",onSubmit:$,children:(0,t.jsx)("div",{className:"flex",children:(0,t.jsx)("button",{onClick:K,className:"bg-red-500 text-white p-2 rounded-lg hover:animate-bounce",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-6",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})})})})})]}),C&&(0,t.jsx)("form",{action:"",onSubmit:function(e){console.log(";;;"),e.preventDefault(),console.log("handle media sent")},children:(0,t.jsx)(m(),{onClick:()=>void(S(!1),L(null),Z(""),console.log("Modal closed. Image file URL:",E,"File:",D),Y.current&&(Y.current.value="")),isOpen:C,className:"fixed inset-0 flex items-center justify-center p-4",overlayClassName:"fixed inset-0 bg-black bg-opacity-50",ariaHideApp:!1,children:(0,t.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg p-6 w-full max-w-lg flex flex-col items-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Send Image"}),E?(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:(0,t.jsx)(o.default,{onClick:()=>{Z(),L()},src:E,alt:"selected file ",width:150,height:150,className:"cursor-pointer"})}):(0,t.jsx)(c._HF,{onClick:()=>Y.current.click(),className:"text-5xl text-gray-400 cursor-pointer"}),(0,t.jsx)("input",{hidden:!0,ref:Y,type:"file",name:"file",accept:"image/*",multiple:!0,onChange:function(e){console.log("add");let s=e.target.files[0];L(s),Z(URL.createObjectURL(s))}}),(0,t.jsx)("button",{type:"submit",onClick:G,disabled:!D,className:"w-full bg-red-600 text-white p-2 shadow-md rounded-lg hover:brightness-105 disabled:bg-gray-200 disabled:cursor-not-allowed disabled:hover:brightness-100",children:"Send Image"}),(0,t.jsx)(h.oHP,{className:"cursor-pointer absolute top-4 right-4 hover:text-red-600 transition duration-300",onClick:()=>S(!1)})]})})})]}):(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"lg:mt-8 h-16 bg-white border rounded flex justify-between ",children:[(0,t.jsx)("div",{className:"flex justify-center items-center",children:(0,t.jsx)("div",{children:r.username})}),(0,t.jsxs)("div",{className:"flex gap-4  ",children:[(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})})}),(0,t.jsx)("div",{className:"flex items-center justify-center"}),(0,t.jsx)("div",{className:"flex items-center justify-center mr-3",children:(0,t.jsx)(c.Dxw,{className:"h-5 cursor-pointer"})})]})]}),(0,t.jsx)("div",{className:" h-96 bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"",children:[(0,t.jsx)("h1",{className:"scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl ",children:"Start Messaging!"}),(0,t.jsx)("div",{className:"",children:(0,t.jsx)(d.J5,{src:"https://lottie.host/ad46920e-be46-4429-beb6-6158cb2bba67/uvrRhaKmT2.json",className:"player",loop:!0,autoplay:!0,style:{height:"300px",width:"300px"}})})]})})]})}},50144:function(e,s,r){r.d(s,{Z:function(){return c}});var t=r(57437),l=r(34203),n=r(47251),i=r(30998),o=r(66648),a=r(2265);function c(e){let{userSelected:s,list:r}=e,{data:c}=(0,i.useSession)(),[d,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(),x=(0,l.s)();console.log(r);let g=(0,n.Z)(e=>e.startVideoCall);return console.log((0,n.Z)(e=>e.isVedioCallActive)),console.log(c),(0,t.jsxs)("div",{className:" bg-gray-100 p-4 mt-8 rounded-lg shadow-md",children:[(0,t.jsxs)("div",{className:"text-center  font-semibold mb-4",children:[" ",(0,t.jsx)("h1",{className:"p-4  text-2xl  font-extrabold  tracking-tight  flex justify-center items-center ",children:"Chat"})]}),(0,t.jsx)("div",{className:"space-y-4",children:r.map(e=>(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex bg-white",children:[(0,t.jsxs)("div",{className:"flex flex-grow items-center space-x-4 p-2 rounded-lg shadow-sm cursor-pointer",onClick:()=>s(e),children:[(0,t.jsx)(o.default,{src:e.profilePicture,alt:e.username,height:40,width:40,className:"rounded-full object-cover h-[40px] w-[40px]"}),(0,t.jsx)("p",{className:"text-md font-medium",children:e.username})]}),(0,t.jsx)("div",{className:" flex items-center justify-end mr-8 cursor-pointer",onClick:()=>{g(),s(e),console.log("call clicked",e),x.emit("call",e.email,c.user.email)},children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})})})]})},e.id))})]})}r(7583)},32205:function(e,s,r){r.d(s,{Z:function(){return d}});var t=r(57437),l=r(34203);r(92914),r(66648);var n=r(2265),i=r(54008);r(7583),r(95956),r(6920);var o=r(77488),a=r(83693),c=r(47251);function d(e){let{setIncomingCallFunction:s,setCallFrom:r,user:d}=e,u=(0,n.useRef)(null),m=(0,n.useRef)(null),[h,x]=(0,n.useState)(null),[g,f]=(0,n.useState)(!0),v=(0,l.s)();console.log(d);let{isVedioCallActive:p,startVideoCall:j,endVideoCall:w}=(0,c.Z)();return(0,n.useEffect)(()=>{let e=new RTCPeerConnection;return x(e),e.onicecandidate=e=>{e.candidate&&(console.log("ice-candidate emit",v.id),v.emit("ice-candidate",e.candidate,d.email))},e.ontrack=e=>{m.current.srcObject=e.streams[0]},navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(s=>{u.current.srcObject=s,s.getTracks().forEach(r=>e.addTrack(r,s))}).then(()=>{console.log("media device working")}).catch(e=>console.error("Error accessing media devices.",e)),v.on("offer",s=>{console.log(s);let r=new RTCSessionDescription(s);e.setRemoteDescription(r).then(()=>e.createAnswer()).then(s=>e.setLocalDescription(s)).then(()=>v.emit("answer",e.localDescription,d.email)).catch(e=>console.error("errrr handling offer",e))}),v.on("answer",s=>{console.log(s),e.setRemoteDescription(new RTCSessionDescription(s)).catch(e=>console.error("error setting remote description"))}),v.on("ice-candidate",s=>{console.log("ice-candidate on",v.id),e.addIceCandidate(new RTCIceCandidate(s)).catch(e=>console.error("Error adding ice candidate.",e))}),()=>{e.close()}},[v,null==d?void 0:d.email]),console.log(s),(0,t.jsx)("div",{children:(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"h-16 bg-white border rounded flex justify-between mt-8",children:[(0,t.jsx)("div",{className:"flex justify-center items-center",children:(0,t.jsx)("div",{children:d.username})}),(0,t.jsxs)("div",{className:"flex gap-4  ",children:[(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"size-6",children:(0,t.jsx)("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z"})})}),(0,t.jsx)("div",{className:"flex items-center justify-center"}),(0,t.jsx)("div",{className:"flex items-center justify-center mr-3",children:(0,t.jsx)(i.Dxw,{className:"h-5 cursor-pointer"})})]})]}),(0,t.jsxs)("div",{className:"relative h-96 bg-gray-50 flex items-center justify-center",children:[(0,t.jsx)("video",{ref:m,className:"w-full h-full object-cover",autoPlay:!0,muted:!0}),(0,t.jsx)("div",{className:"absolute bottom-4 right-4 w-32 h-24 border border-gray-300 rounded-md shadow-lg",children:(0,t.jsx)("video",{ref:u,className:"w-full h-full object-cover rounded-md",autoPlay:!0,muted:!0})})]}),(0,t.jsx)("div",{className:" h-20 flex justify-center items-center gap-4",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4 cursor-pointer",children:[(0,t.jsx)("div",{onClick:()=>{console.log("handlecall"),h.createOffer({offerToReceiveVideo:1}).then(e=>h.setLocalDescription(e)).then(()=>v.emit("offer",h.localDescription,d.email)).catch(e=>console.error("error creating offer",e))},className:"p-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 transition-colors duration-300 transform hover:scale-110",children:(0,t.jsx)(a.Z,{})}),(0,t.jsx)("div",{onClick:w,className:"p-2 rounded-full bg-red-500 text-white hover:bg-red-600 transition-colors duration-300 transform hover:scale-110",children:(0,t.jsx)(o.Z,{})})]})})]})})}}}]);